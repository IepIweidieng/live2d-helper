!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Live2dHelper=e():t.Live2dHelper=e()}(window,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var r,n=function(){function t(){}return t.init=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=!0),this.canLog=t,this.canWarn=e,this.canError=i},t.log=function(e,i){void 0===i&&(i=!1),t.canLog&&console.log("[live2d-helper] "+e)},t.warn=function(e,i){void 0===i&&(i=!1),t.canWarn&&console.warn("[live2d-helper] "+e)},t.error=function(e,i){void 0===i&&(i=!1),t.canError&&console.error("[live2d-helper] "+e)},t.canLog=!0,t.canWarn=!0,t.canError=!0,t}(),o=function(t,e,i,r){return new(i||(i=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},s=function(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},a=function(){function t(){}return t.xhr=function(t,e,i){return new Promise((function(r,n){var o=new XMLHttpRequest;o.open(e,t),o.responseType=i,o.onreadystatechange=function(){4===o.readyState&&(200===o.status?r(o.response):n({status:o.status,message:o.responseText}))},o.send()}))},t.getJson=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.xhr(t,"get","json")];case 1:return[2,e.sent()]}}))}))},t.getBlob=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.xhr(t,"get","blob")];case 1:return[2,e.sent()]}}))}))},t.getArraybuffer=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.xhr(t,"get","arraybuffer")];case 1:return[2,e.sent()]}}))}))},t.arrayBuffer2String=function(t){return String.fromCharCode.apply(null,new Uint8Array(t))},t.getRandomItem=function(t){return t[Math.floor(Math.random()*t.length)]},t}(),u=function(t,e,i,r){return new(i||(i=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},l=function(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},h=function(){function t(){this.model="",this.imageUrl="",this.soundUrl="",this.interval=15e3,this.width=300,this.height=300,this.layout={width:null,height:null,x:null,y:null,center_x:null,center_y:null,top:null,bottom:null,left:null,right:null},this.idle="idle",this.view={VIEW_MAX_SCALE:2,VIEW_MIN_SCALE:.8,VIEW_LOGICAL_LEFT:-1,VIEW_LOGICAL_RIGHT:1,VIEW_LOGICAL_MAX_LEFT:-2,VIEW_LOGICAL_MAX_RIGHT:2,VIEW_LOGICAL_MAX_BOTTOM:-2,VIEW_LOGICAL_MAX_TOP:2},this.initModelCallback=function(t){},this.scaling=!1,this.globalFollowPointer=!1,this.binding={},this.autoLoadAudio={canLoad:!0,callback:function(){}},this.allowSound=!0,this.Priority={None:0,Idle:1,Normal:2,Force:3}}return t.prototype.init=function(t,e){return u(this,void 0,void 0,(function(){var i,r,o,s,u,h,p,c,g,d,_,f,m,y,v,S,x,b,C,B,M;return l(this,(function(l){switch(l.label){case 0:if(("string"==typeof t||t instanceof HTMLCanvasElement)&&"string"==typeof e)if(this.baseUrl=/\/$/.test(e)?e:e+"/","string"==typeof t){if(this.canvas=document.querySelector(t),!this.canvas)throw n.error("Not Found HTMLCanvasElement"),new Error("Not Found HTMLCanvasElement")}else this.canvas=t;else{if(r=t.canvas,o=t.baseUrl,s=t.model,u=t.imageUrl,h=t.soundUrl,p=t.interval,c=t.width,g=t.height,d=t.layout,_=t.debug,f=t.idle,m=t.view,y=t.initModelCallback,v=t.scaling,S=t.globalFollowPointer,x=t.binding,b=t.autoLoadAudio,C=t.allowSound,this.canvas=r instanceof HTMLElement?r:document.querySelector(r),this.baseUrl=/\/$/.test(o)?o:o+"/",this.imageUrl=u||this.baseUrl,this.imageUrl=/\/$/.test(this.imageUrl)?this.imageUrl:this.imageUrl+"/",this.soundUrl=h||this.baseUrl,this.soundUrl=/\/$/.test(this.soundUrl)?this.soundUrl:this.soundUrl+"/",this.interval=p||15e3,this.width=isNaN(Number(c))?800:Number(c),this.height=isNaN(Number(g))?800:Number(g),this.canvas.width=this.width,this.canvas.height=this.height,this.layout=d,this.debug=_||this.debug,this.idle=f,m)for(B in this.view)m[B]&&(this.view[B]=m[B]);this.initModelCallback="function"==typeof y?y:function(t){},this.scaling="boolean"==typeof v&&v,this.globalFollowPointer="boolean"==typeof S&&S,"function"==typeof b?this.autoLoadAudio={canLoad:!0,callback:b}:"boolean"==typeof b&&(this.autoLoadAudio={canLoad:b,callback:function(){}}),this.model=s,i=x,this.allowSound="boolean"!=typeof C||C}return void 0!==this.model&&"string"!=typeof this.model?[3,2]:(this.model=this.model?this.model:this.baseUrl+"model.json",M=this,[4,a.getArraybuffer(this.model)]);case 1:return M.modelBuffer=l.sent(),this.model=JSON.parse(a.arrayBuffer2String(this.modelBuffer)),[3,3];case 2:this.model=this.model,l.label=3;case 3:if(this.initBind(i||{}),!this.canvas||!this.baseUrl)throw n.error("Not Found HTMLCanvasElement OR baseUrl"),new Error("Not Found HTMLCanvasElement OR baseUrl");return[2]}}))}))},t.prototype.initBind=function(t){var e=this;for(var i in t){var r=[],o=function(t){t.hitArea,t.motionPath,t.motionName,t.priority};"string"==typeof t[i]?r.push(t[i]):Array.isArray(t[i])?r.push.apply(r,t[i]):"function"==typeof t[i]?o=t[i]:"object"==typeof t[i]&&(Array.isArray(t[i].motion)?r.push.apply(r,t[i].motion):r.push(t[i].motion),"function"==typeof t[i].callback&&(o=t[i].callback)),this.binding[name]={motion:r,callback:o}}if(this.model.HitAreas)for(var s=JSON.parse(JSON.stringify(this.model.HitAreas)),a=function(t){var i=[];t.Motion&&("string"==typeof t.Motion?i.push(t.Motion):Array.isArray(t.Motion)&&i.push.apply(i,t.Motion)),u.binding[t.Id]?i.forEach((function(i){e.binding[t.Id].motion.includes(i)||e.binding[t.Id].motion.push(i)})):u.binding[t.Id]={motion:i,callback:function(t){t.hitArea,t.motionPath,t.motionName,t.priority}}},u=this,l=0,h=s;l<h.length;l++){a(h[l])}else n.warn("Not Found HitAreas In model.json")},t}();!function(t){var e=function(){function t(t){this.s=t}return t.prototype.append=function(t,e){return this.s+=void 0!==e?t.substr(0,e):t,this},t.prototype.expansion=function(t,e){for(var i=0;i<t;i++)this.append(e);return this},t.prototype.getBytes=function(){return encodeURIComponent(this.s).replace(/%../g,"x").length},t.prototype.getLength=function(){return this.s.length},t.prototype.isLess=function(t){return this.s<t.s},t.prototype.isGreat=function(t){return this.s>t.s},t.prototype.isEqual=function(t){return this.s==t},t.prototype.isEmpty=function(){return 0==this.s.length},t}();t.csmString=e}(r||(r={}));var p,c,g,d,_,f=function(t,e,i){!function(t,e,i){p.CubismDebug.print(t,"[CSM]"+e,i)}(t,e+"\n",i)},m=function(t){console.assert(t)},y=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]},v=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]},S=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]},x=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]};y=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];f(z.LogLevel_Debug,"[D]"+t,e)},v=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];f(z.LogLevel_Info,"[I]"+t,e)},S=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];f(z.LogLevel_Warning,"[W]"+t,e)},x=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];f(z.LogLevel_Error,"[E]"+t,e)},c=p||(p={}),g=function(){function t(){}return t.print=function(t,e,i){if(!(t<k.CubismFramework.getLoggingLevel())){var r=k.CubismFramework.coreLogFunction;r&&r(e.replace(/\{(\d+)\}/g,(function(t,e){return i[e]})))}},t.dumpBytes=function(t,e,i){for(var r=0;r<i;r++)r%16==0&&r>0?this.print(t,"\n"):r%8==0&&r>0&&this.print(t,"  "),this.print(t,"{0} ",[255&e[r]]);this.print(t,"\n")},t}(),c.CubismDebug=g,function(t){var e=function(t,e){this.first=null==t?null:t,this.second=null==e?null:e};t.csmPair=e;var i=function(){function t(t){null!=t?t<1?(this._keyValues=new Array,this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=new Array,this._dummyValue=null,this._size=0)}return t.prototype.release=function(){this.clear()},t.prototype.appendKey=function(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new e(t),this._size+=1},t.prototype.getValue=function(t){for(var e=-1,i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)},t.prototype.setValue=function(t,e){for(var i=-1,r=0;r<this._size;r++)if(this._keyValues[r].first==t){i=r;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)},t.prototype.isExist=function(t){for(var e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1},t.prototype.clear=function(){this._keyValues=void 0,this._keyValues=null,this._keyValues=new Array,this._size=0},t.prototype.getSize=function(){return this._size},t.prototype.prepareCapacity=function(e,i){e>this._keyValues.length&&(0==this._keyValues.length?(!i&&e<t.DefaultSize&&(e=t.DefaultSize),this._keyValues.length=e):(!i&&e<2*this._keyValues.length&&(e=2*this._keyValues.length),this._keyValues.length=e))},t.prototype.begin=function(){return new r(this,0)},t.prototype.end=function(){return new r(this,this._size)},t.prototype.erase=function(t){var e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new r(this,e))},t.prototype.dumpAsInt=function(){for(var t=0;t<this._size;t++)y("{0} ,",this._keyValues[t]),y("\n")},t.DefaultSize=10,t}();t.csmMap=i;var r=function(){function t(t,e){this._map=null!=t?t:new i,this._index=null!=e?e:0}return t.prototype.set=function(t){return this._index=t._index,this._map=t._map,this},t.prototype.preIncrement=function(){return++this._index,this},t.prototype.preDecrement=function(){return--this._index,this},t.prototype.increment=function(){var e=new t(this._map,this._index++);return this._map=e._map,this._index=e._index,this},t.prototype.decrement=function(){var e=new t(this._map,this._index);return this._map=e._map,this._index=e._index,this},t.prototype.ptr=function(){return this._map._keyValues[this._index]},t.prototype.notEqual=function(t){return this._index!=t._index||this._map!=t._map},t}();t.iterator=r}(d||(d={})),function(t){var e=function(){function t(t){void 0===t&&(t=0),t<1?(this._ptr=new Array,this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}return t.prototype.at=function(t){return this._ptr[t]},t.prototype.set=function(t,e){this._ptr[t]=e},t.prototype.get=function(t){void 0===t&&(t=0);for(var e=new Array,i=t;i<this._size;i++)e.push(this._ptr[i]);return e},t.prototype.pushBack=function(e){this._size>=this._capacity&&this.prepareCapacity(0==this._capacity?t.s_defaultSize:2*this._capacity),this._ptr[this._size++]=e},t.prototype.clear=function(){this._ptr.length=0,this._size=0},t.prototype.getSize=function(){return this._size},t.prototype.assign=function(t,e){this._size<t&&this.prepareCapacity(t);for(var i=0;i<t;i++)this._ptr[i]=e;this._size=t},t.prototype.resize=function(t,e){void 0===e&&(e=null),this.updateSize(t,e,!0)},t.prototype.updateSize=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=!0),this._size<t)if(this.prepareCapacity(t),i)for(var r=this._size;r<t;r++)this._ptr[r]="function"==typeof e?JSON.parse(JSON.stringify(new e)):e;else for(r=this._size;r<t;r++)this._ptr[r]=e;else{var n=this._size-t;this._ptr.splice(this._size-n,n)}this._size=t},t.prototype.insert=function(t,e,i){var r=t._index,n=e._index,o=i._index,s=o-n;this.prepareCapacity(this._size+s);var a=this._size-r;if(a>0)for(var u=0;u<a;u++)this._ptr.splice(r+u,0,null);for(u=n;u<o;u++,r++)this._ptr[r]=e._vector._ptr[u];this._size=this._size+s},t.prototype.remove=function(t){return!(t<0||this._size<=t)&&(this._ptr.splice(t,1),--this._size,!0)},t.prototype.erase=function(t){var e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new i(this,e))},t.prototype.prepareCapacity=function(t){t>this._capacity&&(0==this._capacity?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))},t.prototype.begin=function(){return 0==this._size?this.end():new i(this,0)},t.prototype.end=function(){return new i(this,this._size)},t.prototype.getOffset=function(e){var i=new t;return i._ptr=this.get(e),i._size=this.get(e).length,i._capacity=this.get(e).length,i},t.s_defaultSize=10,t}();t.csmVector=e;var i=function(){function t(t,e){this._vector=null!=t?t:null,this._index=null!=e?e:0}return t.prototype.set=function(t){return this._index=t._index,this._vector=t._vector,this},t.prototype.preIncrement=function(){return++this._index,this},t.prototype.preDecrement=function(){return--this._index,this},t.prototype.increment=function(){var e=new t(this._vector,this._index++);return this._vector=e._vector,this._index=e._index,this},t.prototype.decrement=function(){var e=new t(this._vector,this._index--);return this._vector=e._vector,this._index=e._index,this},t.prototype.ptr=function(){return this._vector._ptr[this._index]},t.prototype.substitution=function(t){return this._index=t._index,this._vector=t._vector,this},t.prototype.notEqual=function(t){return this._index!=t._index||this._vector!=t._vector},t}();t.iterator=i}(_||(_={}));var b,C,B=(b=function(t,e){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}b(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),M=_.csmVector,P=d.csmMap,w=r.csmString;!function(t){var e=function(){function t(){}return t.prototype.getRawString=function(t,e){return this.getString(t,e)},t.prototype.toInt=function(t){return void 0===t&&(t=0),t},t.prototype.toFloat=function(t){return void 0===t&&(t=0),t},t.prototype.toBoolean=function(t){return void 0===t&&(t=!1),t},t.prototype.getSize=function(){return 0},t.prototype.getArray=function(t){return void 0===t&&(t=null),t},t.prototype.getVector=function(t){return t},t.prototype.getMap=function(t){return t},t.prototype.getValueByIndex=function(e){return t.errorValue.setErrorNotForClientCall("Error: type mismatch")},t.prototype.getValueByString=function(e){return t.nullValue.setErrorNotForClientCall("Error: type mismatch")},t.prototype.getKeys=function(){return t.s_dummyKeys},t.prototype.isError=function(){return!1},t.prototype.isNull=function(){return!1},t.prototype.isBool=function(){return!1},t.prototype.isFloat=function(){return!1},t.prototype.isString=function(){return!1},t.prototype.isArray=function(){return!1},t.prototype.isMap=function(){return!1},t.prototype.equals=function(t){return!1},t.prototype.isStatic=function(){return!1},t.prototype.setErrorNotForClientCall=function(t){return s.errorValue},t.staticInitializeNotForClientCall=function(){n.trueValue=new n(!0),n.falseValue=new n(!1),s.errorValue=new s("ERROR",!0),this.nullValue=new a,t.s_dummyKeys=new M},t.staticReleaseNotForClientCall=function(){n.trueValue=null,n.falseValue=null,s.errorValue=null,t.nullValue=null,t.s_dummyKeys=null,n.trueValue=null,n.falseValue=null,s.errorValue=null,t.nullValue=null,t.s_dummyKeys=null},t}();t.Value=e;var i=function(){function t(t,e){this._error=null,this._lineCount=0,this._root=null,null!=t&&this.parseBytes(t,e)}return t.create=function(e,i){var r=new t;return r.parseBytes(e,i)?r:(t.delete(r),null)},t.delete=function(t){null},t.prototype.getRoot=function(){return this._root},t.prototype.arrayBufferToString=function(t){for(var e=new Uint8Array(t),i="",r=0,n=e.length;r<n;++r)i+="%"+this.pad(e[r].toString(16));return i=decodeURIComponent(i)},t.prototype.pad=function(t){return t.length<2?"0"+t:t},t.prototype.parseBytes=function(t,e){var i=new Array(1),r=this.arrayBufferToString(t);if(this._root=this.parseValue(r,e,0,i),this._error){var n;return n="Json parse error : @line "+(this._lineCount+1)+"\n",this._root=new o(n),v("{0}",this._root.getRawString()),!1}return null!=this._root||(this._root=new s(new w(this._error),!1),!1)},t.prototype.getParseError=function(){return this._error},t.prototype.checkEndOfFile=function(){return this._root.getArray()[1].equals("EOF")},t.prototype.parseValue=function(t,e,i,s){if(this._error)return null;for(var u,l=null,h=i;h<e;h++){switch(t[h]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":var p=new Array(1);return u=U(t.slice(h),p),s[0]=t.indexOf(p[0]),new r(u);case'"':return new o(this.parseString(t,e,h+1,s));case"[":return l=this.parseArray(t,e,h+1,s);case"{":return l=this.parseObject(t,e,h+1,s);case"n":return h+3<e?(l=new a,s[0]=h+4):this._error="parse null",l;case"t":return h+3<e?(l=n.trueValue,s[0]=h+4):this._error="parse true",l;case"f":return h+4<e?(l=n.falseValue,s[0]=h+5):this._error="illegal ',' position",l;case",":return this._error="illegal ',' position",null;case"]":return s[0]=h,null;case"\n":this._lineCount++}}return this._error="illegal end of value",null},t.prototype.parseString=function(t,e,i,r){if(this._error)return null;for(var n=i,o=new w(""),s=i;n<e;n++)switch(t[n]){case'"':return r[0]=n+1,o.append(t.slice(s),n-s),o.s;case"//":if(++n-1>s&&o.append(t.slice(s),n-s),s=n+1,n<e)switch(t[n]){case"\\":o.expansion(1,"\\");break;case'"':o.expansion(1,'"');break;case"/":o.expansion(1,"/");break;case"b":o.expansion(1,"\b");break;case"f":o.expansion(1,"\f");break;case"n":o.expansion(1,"\n");break;case"r":o.expansion(1,"\r");break;case"t":o.expansion(1,"\t");break;case"u":this._error="parse string/unicord escape not supported"}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null},t.prototype.parseObject=function(t,e,i,r){if(this._error)return null;for(var n=new l,o="",s=i,a=Array(1),u=!1;s<e;s++){t:for(;s<e;s++)switch(t[s]){case'"':if(o=this.parseString(t,e,s+1,a),this._error)return null;s=a[0],u=!0;break t;case"}":return r[0]=s+1,n;case":":this._error="illegal ':' position";break;case"\n":this._lineCount++}if(!u)return this._error="key not found",null;u=!1;t:for(;s<e;s++)switch(t[s]){case":":u=!0,s++;break t;case"}":this._error="illegal '}' position";break;case"\n":this._lineCount++}if(!u)return this._error="':' not found",null;var h=this.parseValue(t,e,s,a);if(this._error)return null;s=a[0],n.put(o,h);t:for(;s<e;s++)switch(t[s]){case",":break t;case"}":return r[0]=s+1,n;case"\n":this._lineCount++}}return this._error="illegal end of perseObject",null},t.prototype.parseArray=function(t,e,i,r){if(this._error)return null;for(var n=new u,o=i,s=new Array(1);o<e;o++){var a=this.parseValue(t,e,o,s);if(this._error)return null;o=s[0],a&&n.add(a);t:for(;o<e;o++)switch(t[o]){case",":break t;case"]":return r[0]=o+1,n;case"\n":++this._lineCount}}return n=void 0,this._error="illegal end of parseObject",null},t}();t.CubismJson=i;var r=function(t){function e(e){var i=t.call(this)||this;return i._value=e,i}return B(e,t),e.prototype.isFloat=function(){return!0},e.prototype.getString=function(t,e){return this._value=parseFloat("\0"),this._stringBuffer="\0",this._stringBuffer},e.prototype.toInt=function(t){return void 0===t&&(t=0),parseInt(this._value.toString())},e.prototype.toFloat=function(t){return void 0===t&&(t=0),this._value},e.prototype.equals=function(t){return"number"==typeof t&&(!Math.round(t)&&t==this._value)},e}(e);t.JsonFloat=r;var n=function(t){function e(e){var i=t.call(this)||this;return i._boolValue=e,i}return B(e,t),e.prototype.isBool=function(){return!0},e.prototype.toBoolean=function(t){return void 0===t&&(t=!1),this._boolValue},e.prototype.getString=function(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer},e.prototype.equals=function(t){return"boolean"==typeof t&&t==this._boolValue},e.prototype.isStatic=function(){return!0},e}(e);t.JsonBoolean=n;var o=function(t){function e(e){var i=t.call(this)||this;return"string"==typeof e&&(i._stringBuffer=e),e instanceof w&&(i._stringBuffer=e.s),i}return B(e,t),e.prototype.isString=function(){return!0},e.prototype.getString=function(t,e){return this._stringBuffer},e.prototype.equals=function(t){return"string"==typeof t?this._stringBuffer==t:t instanceof w&&this._stringBuffer==t.s},e}(e);t.JsonString=o;var s=function(t){function e(e,i){var r=this;return(r=t.call(this,e)||this)._isStatic=i,r}return B(e,t),e.prototype.isStatic=function(){return this._isStatic},e.prototype.setErrorNotForClientCall=function(t){return this._stringBuffer=t,this},e.prototype.isError=function(){return!0},e}(o);t.JsonError=s;var a=function(t){function e(){var e=t.call(this)||this;return e._stringBuffer="NullValue",e}return B(e,t),e.prototype.isNull=function(){return!0},e.prototype.getString=function(t,e){return this._stringBuffer},e.prototype.isStatic=function(){return!0},e}(e);t.JsonNullvalue=a;var u=function(t){function i(){var e=t.call(this)||this;return e._array=new M,e}return B(i,t),i.prototype.release=function(){for(var t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){var e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}},i.prototype.isArray=function(){return!0},i.prototype.getValueByIndex=function(t){if(t<0||this._array.getSize()<=t)return e.errorValue.setErrorNotForClientCall("Error: index out of bounds");var i=this._array.at(t);return null==i?e.nullValue:i},i.prototype.getValueByString=function(t){return e.errorValue.setErrorNotForClientCall("Error: type mismatch")},i.prototype.getString=function(t,e){for(var i=e+"[\n",r=this._array.begin();r.notEqual(this._array.end());r.increment()){var n=r.ptr();this._stringBuffer+=e+""+n.getString(e+" ")+"\n"}return this._stringBuffer=i+e+"]\n",this._stringBuffer},i.prototype.add=function(t){this._array.pushBack(t)},i.prototype.getVector=function(t){return void 0===t&&(t=null),this._array},i.prototype.getSize=function(){return this._array.getSize()},i}(e);t.JsonArray=u;var l=function(t){function i(){var e=t.call(this)||this;return e._map=new P,e}return B(i,t),i.prototype.release=function(){for(var t=this._map.begin();t.notEqual(this._map.end());){var e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}},i.prototype.isMap=function(){return!0},i.prototype.getValueByString=function(t){if(t instanceof w){var i=this._map.getValue(t.s);return null==i?e.nullValue:i}for(var r=this._map.begin();r.notEqual(this._map.end());r.preIncrement())if(r.ptr().first==t)return null==r.ptr().second?e.nullValue:r.ptr().second;return e.nullValue},i.prototype.getValueByIndex=function(t){return e.errorValue.setErrorNotForClientCall("Error: type mismatch")},i.prototype.getString=function(t,e){this._stringBuffer=e+"{\n";for(var i=this._map.begin();i.notEqual(this._map.end());){var r=i.ptr().first,n=i.ptr().second;this._stringBuffer+=e+" "+r+" : "+n.getString(e+"   ")+" \n",i.preIncrement()}return this._stringBuffer+=e+"}\n",this._stringBuffer},i.prototype.getMap=function(t){return this._map},i.prototype.put=function(t,e){this._map.setValue(t,e)},i.prototype.getKeys=function(){if(!this._keys){this._keys=new M;for(var t=this._map.begin();t.notEqual(this._map.end());){var e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys},i.prototype.getSize=function(){return this._keys.getSize()},i}(e);t.JsonMap=l}(C||(C={}));var I,V=r.csmString;!function(t){var e=function(){function t(t){this._id="string"!=typeof t?t:new V(t)}return t.prototype.getString=function(){return this._id},t.prototype.isEqual=function(e){return"string"==typeof e?this._id.isEqual(e):e instanceof V?this._id.isEqual(e.s):e instanceof t&&this._id.isEqual(e._id.s)},t.prototype.isNotEqual=function(e){return"string"==typeof e?!this._id.isEqual(e):e instanceof V?!this._id.isEqual(e.s):e instanceof t&&!this._id.isEqual(e._id.s)},t}();t.CubismId=e}(I||(I={}));var T,E,F=I.CubismId,L=_.csmVector;!function(t){var e=function(){function t(){this._ids=new L}return t.prototype.release=function(){for(var t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null},t.prototype.registerIds=function(t){for(var e=0;e<t.length;e++)this.registerId(t[e])},t.prototype.registerId=function(t){var e=null;return"string"!=typeof t?this.registerId(t.s):null!=(e=this.findId(t))?e:(e=new F(t),this._ids.pushBack(e),e)},t.prototype.getId=function(t){return this.registerId(t)},t.prototype.isExist=function(t){return"string"==typeof t?null!=this.findId(t):this.isExist(t.s)},t.prototype.findId=function(t){for(var e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null},t}();t.CubismIdManager=e}(T||(T={})),function(t){var e=function(){function t(){this._tr=new Float32Array(16),this.loadIdentity()}return t.multiply=function(t,e,i){for(var r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),n=0;n<4;++n)for(var o=0;o<4;++o)for(var s=0;s<4;++s)r[o+4*n]+=t[s+4*n]*e[o+4*s];for(n=0;n<16;++n)i[n]=r[n]},t.prototype.loadIdentity=function(){var t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)},t.prototype.setMatrix=function(t){for(var e=0;e<16;++e)this._tr[e]=t[e]},t.prototype.getArray=function(){return this._tr},t.prototype.getScaleX=function(){return this._tr[0]},t.prototype.getScaleY=function(){return this._tr[5]},t.prototype.getTranslateX=function(){return this._tr[12]},t.prototype.getTranslateY=function(){return this._tr[13]},t.prototype.transformX=function(t){return this._tr[0]*t+this._tr[12]},t.prototype.transformY=function(t){return this._tr[5]*t+this._tr[13]},t.prototype.invertTransformX=function(t){return(t-this._tr[12])/this._tr[0]},t.prototype.invertTransformY=function(t){return(t-this._tr[13])/this._tr[5]},t.prototype.translateRelative=function(e,i){var r=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,i,0,1]);t.multiply(r,this._tr,this._tr)},t.prototype.translate=function(t,e){this._tr[12]=t,this._tr[13]=e},t.prototype.translateX=function(t){this._tr[12]=t},t.prototype.translateY=function(t){this._tr[13]=t},t.prototype.scaleRelative=function(e,i){var r=new Float32Array([e,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]);t.multiply(r,this._tr,this._tr)},t.prototype.scale=function(t,e){this._tr[0]=t,this._tr[5]=e},t.prototype.multiplyByMatrix=function(e){t.multiply(e.getArray(),this._tr,this._tr)},t.prototype.clone=function(){for(var e=new t,i=0;i<this._tr.length;i++)e._tr[i]=this._tr[i];return e},t}();t.CubismMatrix44=e}(E||(E={}));var R,A=E.CubismMatrix44;!function(t){var e=function(){function t(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisortopy=0,this._model=null,this._modelColor=new i,this._mvpMatrix4x4=new A,this._mvpMatrix4x4.loadIdentity()}return t.create=function(){return null},t.delete=function(t){null},t.prototype.initialize=function(t){this._model=t},t.prototype.drawModel=function(){null!=this.getModel()&&this.doDrawModel()},t.prototype.setMvpMatrix=function(t){this._mvpMatrix4x4.setMatrix(t.getArray())},t.prototype.getMvpMatrix=function(){return this._mvpMatrix4x4},t.prototype.setModelColor=function(t,e,i,r){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=r},t.prototype.getModelColor=function(){return JSON.parse(JSON.stringify(this._modelColor))},t.prototype.setIsPremultipliedAlpha=function(t){this._isPremultipliedAlpha=t},t.prototype.isPremultipliedAlpha=function(){return this._isPremultipliedAlpha},t.prototype.setIsCulling=function(t){this._isCulling=t},t.prototype.isCulling=function(){return this._isCulling},t.prototype.setAnisotropy=function(t){this._anisortopy=t},t.prototype.getAnisotropy=function(){return this._anisortopy},t.prototype.getModel=function(){return this._model},t}();t.CubismRenderer=e,function(t){t[t.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",t[t.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",t[t.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative"}(t.CubismBlendMode||(t.CubismBlendMode={}));var i=function(){this.R=1,this.G=1,this.B=1,this.A=1};t.CubismTextureColor=i}(R||(R={}));var k,D=C.Value,N=T.CubismIdManager,O=R.CubismRenderer;function U(t,e){for(var i=0,r=1;;r++){var n=t.slice(r-1,r);if("e"!=n&&"-"!=n&&"E"!=n){var o=t.substring(0,r),s=Number(o);if(isNaN(s))break;i=r}}var a=parseFloat(t);return isNaN(a)&&(a=NaN),e[0]=t.slice(i),a}!function(t){var e=!1,i=!1,r=null,n=null;!function(t){t.vertexOffset=0,t.vertexStep=2}(t.Constant||(t.Constant={})),t.csmDelete=function(t){t&&(t=void 0)};var o=function(){function t(){}return t.startUp=function(t){if(void 0===t&&(t=null),e)return v("CubismFramework.startUp() is already done."),e;if(null!=(r=t)&&Live2DCubismCore.Logging.csmSetLogFunction(r.logFunction),e=!0){var i=Live2DCubismCore.Version.csmGetVersion(),n=(16711680&i)>>16,o=65535&i,s=i;v("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+((4278190080&i)>>24)).slice(-2),("00"+n).slice(-2),("0000"+o).slice(-4),s)}return v("CubismFramework.startUp() is complete."),e},t.cleanUp=function(){e=!1,i=!1,r=null,n=null},t.initialize=function(){m(e),e?i?S("CubismFramework.initialize() skipped, already initialized."):(D.staticInitializeNotForClientCall(),n=new N,i=!0,v("CubismFramework.initialize() is complete.")):S("CubismFramework is not started.")},t.dispose=function(){m(e),e?i?(D.staticReleaseNotForClientCall(),n.release(),n=null,O.staticRelease(),i=!1,v("CubismFramework.dispose() is complete.")):S("CubismFramework.dispose() skipped, not initialized."):S("CubismFramework is not started.")},t.isStarted=function(){return e},t.isInitialized=function(){return i},t.coreLogFunction=function(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)},t.getLoggingLevel=function(){return null!=r?r.loggingLevel:z.LogLevel_Off},t.getIdManager=function(){return n},t}();t.CubismFramework=o}(k||(k={}));var z,j=function(){};!function(t){t[t.LogLevel_Verbose=0]="LogLevel_Verbose",t[t.LogLevel_Debug=1]="LogLevel_Debug",t[t.LogLevel_Info=2]="LogLevel_Info",t[t.LogLevel_Warning=3]="LogLevel_Warning",t[t.LogLevel_Error=4]="LogLevel_Error",t[t.LogLevel_Off=5]="LogLevel_Off"}(z||(z={}));var X,Y=function(t,e,i,r){return new(i||(i=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},G=function(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},q=_.csmVector,H=function(){function t(t){this._textures=new q,this.webgl=t}return t.prototype.release=function(){for(var t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())this.webgl.gl.deleteTexture(t.ptr().id);this._textures=null},t.prototype.createTextureFromPngFile=function(t,e){return Y(this,void 0,void 0,(function(){var i=this;return G(this,(function(r){return[2,new Promise((function(r,n){return Y(i,void 0,void 0,(function(){var i,n,o,s,u,l=this;return G(this,(function(h){switch(h.label){case 0:for(i=this._textures.begin();i.notEqual(this._textures.end());i.preIncrement())if(i.ptr().fileName==t&&i.ptr().usePremultply==e)return r(i.ptr()),[2];return(n=new Image).onload=function(){var i=l.webgl.gl.createTexture();l.webgl.gl.bindTexture(l.webgl.gl.TEXTURE_2D,i),l.webgl.gl.texParameteri(l.webgl.gl.TEXTURE_2D,l.webgl.gl.TEXTURE_MIN_FILTER,l.webgl.gl.LINEAR_MIPMAP_LINEAR),l.webgl.gl.texParameteri(l.webgl.gl.TEXTURE_2D,l.webgl.gl.TEXTURE_MAG_FILTER,l.webgl.gl.LINEAR),e&&l.webgl.gl.pixelStorei(l.webgl.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),l.webgl.gl.texImage2D(l.webgl.gl.TEXTURE_2D,0,l.webgl.gl.RGBA,l.webgl.gl.RGBA,l.webgl.gl.UNSIGNED_BYTE,n),l.webgl.gl.generateMipmap(l.webgl.gl.TEXTURE_2D),l.webgl.gl.bindTexture(l.webgl.gl.TEXTURE_2D,null);var o=new W;o.fileName=t,o.width=n.width,o.height=n.height,o.id=i,o.img=n,o.usePremultply=e,l._textures.pushBack(o),r(o)},o=n,u=(s=URL).createObjectURL,[4,a.getBlob(t)];case 1:return o.src=u.apply(s,[h.sent()]),[2]}}))}))}))]}))}))},t.prototype.releaseTextures=function(){for(var t=0;t<this._textures.getSize();t++)this._textures.set(t,null);this._textures.clear()},t.prototype.releaseTextureByTexture=function(t){for(var e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id==t){this._textures.set(e,null),this._textures.remove(e);break}},t.prototype.releaseTextureByFilePath=function(t){for(var e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName==t){this._textures.set(e,null),this._textures.remove(e);break}},t}(),W=function(){this.id=null,this.width=0,this.height=0},J=function(){function t(t){this.gl=t.getContext("webgl"),this.frameBuffer=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}return t.prototype.createShader=function(){var t=this.gl.createShader(this.gl.VERTEX_SHADER);if(null==t)return null;this.gl.shaderSource(t,"precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}"),this.gl.compileShader(t);var e=this.gl.createShader(this.gl.FRAGMENT_SHADER);if(null==e)return null;this.gl.shaderSource(e,"precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}"),this.gl.compileShader(e);var i=this.gl.createProgram();return this.gl.attachShader(i,t),this.gl.attachShader(i,e),this.gl.deleteShader(t),this.gl.deleteShader(e),this.gl.linkProgram(i),this.gl.useProgram(i),i},t}(),K=function(){function t(t){this._webgl=t}return t.prototype.render=function(){this._webgl.gl.useProgram(this._programId),this._webgl.gl.flush()},t}();!function(t){var e=function(){function t(t,e){this.x=t,this.y=e,this.x=null==t?0:t,this.y=null==e?0:e}return t.prototype.add=function(e){var i=new t(0,0);return i.x=this.x+e.x,i.y=this.y+e.y,i},t.prototype.substract=function(e){var i=new t(0,0);return i.x=this.x-e.x,i.y=this.y-e.y,i},t.prototype.multiply=function(e){var i=new t(0,0);return i.x=this.x*e.x,i.y=this.y*e.y,i},t.prototype.multiplyByScaler=function(e){return this.multiply(new t(e,e))},t.prototype.division=function(e){var i=new t(0,0);return i.x=this.x/e.x,i.y=this.y/e.y,i},t.prototype.divisionByScalar=function(e){return this.division(new t(e,e))},t.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.getDistanceWith=function(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.normalize=function(){var t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t},t.prototype.isEqual=function(t){return this.x==t.x&&this.y==t.y},t.prototype.isNotEqual=function(t){return!this.isEqual(t)},t}();t.CubismVector2=e}(X||(X={}));var Z,Q=X.CubismVector2;!function(t){var e=function(){function t(){}return t.range=function(t,e,i){return t<e?t=e:t>i&&(t=i),t},t.sin=function(t){return Math.sin(t)},t.cos=function(t){return Math.cos(t)},t.abs=function(t){return Math.abs(t)},t.sqrt=function(t){return Math.sqrt(t)},t.getEasingSine=function(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)},t.max=function(t,e){return t>e?t:e},t.min=function(t,e){return t>e?e:t},t.degreesToRadian=function(t){return t/180*Math.PI},t.radianToDegrees=function(t){return 180*t/Math.PI},t.directionToRadian=function(t,e){for(var i=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return i},t.directionToDegrees=function(t,e){var i=this.directionToRadian(t,e),r=this.radianToDegrees(i);return e.x-t.x>0&&(r=-r),r},t.radianToDirection=function(t){var e=new Q;return e.x=this.sin(t),e.y=this.cos(t),e},t}();t.CubismMath=e}(Z||(Z={}));var $,tt=_.csmVector,et=Z.CubismMath;!function(t){var e=function(){function t(){this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new tt}return t.delete=function(t){t.release(),t=void 0,t=null},t.prototype.release=function(){this._weight=0},t.prototype.updateParameters=function(t,e,i){if(e.isAvailable()&&!e.isFinished()){if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);var r=this.getDuration();e.getEndTime()<0&&e.setEndTime(r<=0?-1:e.getStartTime()+r)}var n=this._weight;n=n*(0==this._fadeInSeconds?1:et.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds))*(0==this._fadeOutSeconds||e.getEndTime()<0?1:et.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds)),e.setState(i,n),m(0<=n&&n<=1),this.doUpdateParameters(t,i,n,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}},t.prototype.setFadeInTime=function(t){this._fadeInSeconds=t},t.prototype.setFadeOutTime=function(t){this._fadeOutSeconds=t},t.prototype.getFadeOutTime=function(){return this._fadeOutSeconds},t.prototype.getFadeInTime=function(){return this._fadeInSeconds},t.prototype.setWeight=function(t){this._weight=t},t.prototype.getWeight=function(){return this._weight},t.prototype.getDuration=function(){return-1},t.prototype.getLoopDuration=function(){return-1},t.prototype.setOffsetTime=function(t){this._offsetSeconds=t},t.prototype.getFiredEvent=function(t,e){return this._firedEventValues},t}();t.ACubismMotion=e}($||($={}));var it,rt=$.ACubismMotion;!function(t){var e=function(){function t(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this}return t.prototype.release=function(){this._autoDelete&&this._motion&&rt.delete(this._motion)},t.prototype.startFadeout=function(t,e){var i=e+t;(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)},t.prototype.isFinished=function(){return this._finished},t.prototype.isStarted=function(){return this._started},t.prototype.getStartTime=function(){return this._startTimeSeconds},t.prototype.getFadeInStartTime=function(){return this._fadeInStartTimeSeconds},t.prototype.getEndTime=function(){return this._endTimeSeconds},t.prototype.setStartTime=function(t){this._startTimeSeconds=t},t.prototype.setFadeInStartTime=function(t){this._fadeInStartTimeSeconds=t},t.prototype.setEndTime=function(t){this._endTimeSeconds=t},t.prototype.setIsFinished=function(t){this._finished=t},t.prototype.setIsStarted=function(t){this._started=t},t.prototype.isAvailable=function(){return this._available},t.prototype.setIsAvailable=function(t){this._available=t},t.prototype.setState=function(t,e){this._stateTimeSeconds=t,this._stateWeight=e},t.prototype.getStateTime=function(){return this._stateTimeSeconds},t.prototype.getStateWeight=function(){return this._stateWeight},t.prototype.getLastCheckEventTime=function(){return this._lastEventCheckSeconds},t.prototype.setLastCheckEventTime=function(t){this._lastEventCheckSeconds=t},t}();t.CubismMotionQueueEntry=e}(it||(it={}));var nt,ot=_.csmVector,st=it.CubismMotionQueueEntry;!function(t){var e=function(){function e(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new ot}return e.prototype.release=function(){for(var t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,void 0),this._motions.set(t,null));this._motions=null},e.prototype.startMotion=function(e,i,r){if(null==e)return t.InvalidMotionQueueEntryHandleValue;for(var n=null,o=0;o<this._motions.getSize();++o)null!=(n=this._motions.at(o))&&n.startFadeout(n._motion.getFadeOutTime(),r);return(n=new st)._autoDelete=i,n._motion=e,this._motions.pushBack(n),n._motionQueueEntryHandle},e.prototype.isFinished=function(){for(var t=this._motions.begin();t.notEqual(this._motions.end());){var e=t.ptr();if(null!=e)if(null!=e._motion){if(!e.isFinished())return!1;t.preIncrement()}else e.release(),e=void 0,e=null,t=this._motions.erase(t);else t=this._motions.erase(t)}return!0},e.prototype.isFinishedByHandle=function(t){for(var e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){var i=e.ptr();if(null!=i&&(i._motionQueueEntryHandle==t&&!i.isFinished()))return!1}return!0},e.prototype.stopAllMotions=function(){for(var t=this._motions.begin();t.notEqual(this._motions.end());){var e=t.ptr();null!=e?(e.release(),e=void 0,e=null,t=this._motions.erase(t)):t=this._motions.erase(t)}},e.prototype.getCubismMotionQueueEntry=function(t){for(var e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){var i=e.ptr();if(null!=i&&i._motionQueueEntryHandle==t)return i}return null},e.prototype.setEventCallback=function(t,e){void 0===e&&(e=null),this._eventCallBack=t,this._eventCustomData=e},e.prototype.doUpdateMotion=function(t,e){for(var i=!1,r=this._motions.begin();r.notEqual(this._motions.end());){var n=r.ptr();if(null!=n){var o=n._motion;if(null!=o){o.updateParameters(t,n,e),i=!0;for(var s=o.getFiredEvent(n.getLastCheckEventTime()-n.getStartTime(),e-n.getStartTime()),a=0;a<s.getSize();++a)this._eventCallBack(this,s.at(a),this._eventCustomData);n.setLastCheckEventTime(e),n.isFinished()?(n.release(),n=void 0,n=null,r=this._motions.erase(r)):r.preIncrement()}else n.release(),n=void 0,n=null,r=this._motions.erase(r)}else r=this._motions.erase(r)}return i},e}();t.CubismMotionQueueManager=e,t.InvalidMotionQueueEntryHandleValue=-1}(nt||(nt={}));var at,ut=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),lt=nt.CubismMotionQueueManager;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._currentPriority=0,e._reservePriority=0,e}return ut(e,t),e.prototype.getCurrentPriority=function(){return this._currentPriority},e.prototype.getReservePriority=function(){return this._reservePriority},e.prototype.setReservePriority=function(t){this._reservePriority=t},e.prototype.startMotionPriority=function(e,i,r){return r==this._reservePriority&&(this._reservePriority=0),this._currentPriority=r,t.prototype.startMotion.call(this,e,i,this._userTimeSeconds)},e.prototype.updateMotion=function(e,i){this._userTimeSeconds+=i;var r=t.prototype.doUpdateMotion.call(this,e,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),r},e.prototype.reserveMotion=function(t){return!(t<=this._reservePriority||t<=this._currentPriority)&&(this._reservePriority=t,!0)},e}(lt);t.CubismMotionManager=e}(at||(at={}));var ht,pt=Z.CubismMath;!function(t){var e=function(){function t(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}return t.prototype.update=function(t){this._userTimeSeconds+=t;if(0!=this._lastTimeSeconds){var e=30*(this._userTimeSeconds-this._lastTimeSeconds);this._lastTimeSeconds=this._userTimeSeconds;var i=e*(4/30)/4.5,r=this._faceTargetX-this._faceX,n=this._faceTargetY-this._faceY;if(!(pt.abs(r)<=.01&&pt.abs(n)<=.01)){var o=pt.sqrt(r*r+n*n),s=4/30*n/o,a=4/30*r/o-this._faceVX,u=s-this._faceVY,l=pt.sqrt(a*a+u*u);(l<-i||l>i)&&(a*=i/l,u*=i/l),this._faceVX+=a,this._faceVY+=u;var h=.5*(pt.sqrt(i*i+16*i*o-8*i*o)-i),p=pt.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);p>h&&(this._faceVX*=h/p,this._faceVY*=h/p),this._faceX+=this._faceVX,this._faceY+=this._faceVY}}else this._lastTimeSeconds=this._userTimeSeconds},t.prototype.getX=function(){return this._faceX},t.prototype.getY=function(){return this._faceY},t.prototype.set=function(t,e){this._faceTargetX=t,this._faceTargetY=e},t}();t.CubismTargetPoint=e}(ht||(ht={}));var ct,gt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),dt=E.CubismMatrix44;!function(t){var e=function(t){function e(e,i){var r=t.call(this)||this;return r._width=void 0!==e?e:0,r._height=void 0!==i?i:0,r.setHeight(1),r}return gt(e,t),e.prototype.setWidth=function(t){var e=t/this._width,i=e;this.scale(e,i)},e.prototype.setHeight=function(t){var e=t/this._height,i=e;this.scale(e,i)},e.prototype.setPosition=function(t,e){this.translate(t,e)},e.prototype.setCenterPosition=function(t,e){this.centerX(t),this.centerY(e)},e.prototype.top=function(t){this.setY(t)},e.prototype.bottom=function(t){var e=this._height*this.getScaleY();this.translateY(t-e)},e.prototype.left=function(t){this.setX(t)},e.prototype.right=function(t){var e=this._width*this.getScaleX();this.translateX(t-e)},e.prototype.centerX=function(t){var e=this._width*this.getScaleX();this.translateX(t-e/2)},e.prototype.setX=function(t){this.translateX(t)},e.prototype.centerY=function(t){var e=this._height*this.getScaleY();this.translateY(t-e/2)},e.prototype.setY=function(t){this.translateY(t)},e.prototype.setupFromLayout=function(t){for(var e=t.begin();e.notEqual(t.end());e.preIncrement()){var i=e.ptr().first,r=e.ptr().second;"width"==i?this.setWidth(r):"height"==i&&this.setHeight(r)}for(e=t.begin();e.notEqual(t.end());e.preIncrement()){i=e.ptr().first,r=e.ptr().second;"x"==i?this.setX(r):"y"==i?this.setY(r):"center_x"==i?this.centerX(r):"center_y"==i?this.centerY(r):"top"==i?this.top(r):"bottom"==i?this.bottom(r):"left"==i?this.left(r):"right"==i&&this.right(r)}},e}(dt);t.CubismModelMatrix=e}(ct||(ct={}));var _t,ft=k.CubismFramework,mt=R.CubismBlendMode,yt=_.csmVector,vt=d.csmMap;!function(t){var e=function(){function t(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new yt,this._parameterIds=new yt,this._drawableIds=new yt,this._partIds=new yt,this._notExistPartId=new vt,this._notExistParameterId=new vt,this._notExistParameterValues=new vt,this._notExistPartOpacities=new vt}return t.prototype.update=function(){this._model.update(),this._model.drawables.resetDynamicFlags()},t.prototype.getCanvasWidth=function(){return null==this._model?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit},t.prototype.getCanvasHeight=function(){return null==this._model?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit},t.prototype.saveParameters=function(){for(var t=this._model.parameters.count,e=this._savedParameters.getSize(),i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])},t.prototype.getModel=function(){return this._model},t.prototype.getPartIndex=function(t){var e,i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)},t.prototype.getPartCount=function(){return this._model.parts.count},t.prototype.setPartOpacityByIndex=function(t,e){this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.setValue(t,e):(m(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e)},t.prototype.setPartOpacityById=function(t,e){var i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)},t.prototype.getPartOpacityByIndex=function(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(m(0<=t&&t<this.getPartCount()),this._partOpacities[t])},t.prototype.getPartOpacityById=function(t){var e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)},t.prototype.getParameterIndex=function(t){var e,i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)},t.prototype.getParameterCount=function(){return this._model.parameters.count},t.prototype.getParameterMaximumValue=function(t){return this._model.parameters.maximumValues[t]},t.prototype.getParameterMinimumValue=function(t){return this._model.parameters.minimumValues[t]},t.prototype.getParameterDefaultValue=function(t){return this._model.parameters.defaultValues[t]},t.prototype.getParameterValueByIndex=function(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(m(0<=t&&t<this.getParameterCount()),this._parameterValues[t])},t.prototype.getParameterValueById=function(t){var e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)},t.prototype.setParameterValueByIndex=function(t,e,i){void 0===i&&(i=1),this._notExistParameterValues.isExist(t)?this._notExistParameterValues.setValue(t,1==i?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i):(m(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=1==i?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i)},t.prototype.setParameterValueById=function(t,e,i){void 0===i&&(i=1);var r=this.getParameterIndex(t);this.setParameterValueByIndex(r,e,i)},t.prototype.addParameterValueByIndex=function(t,e,i){void 0===i&&(i=1),this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)},t.prototype.addParameterValueById=function(t,e,i){void 0===i&&(i=1);var r=this.getParameterIndex(t);this.addParameterValueByIndex(r,e,i)},t.prototype.multiplyParameterValueById=function(t,e,i){void 0===i&&(i=1);var r=this.getParameterIndex(t);this.multiplyParameterValueByIndex(r,e,i)},t.prototype.multiplyParameterValueByIndex=function(t,e,i){void 0===i&&(i=1),this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))},t.prototype.getDrawableIndex=function(t){for(var e=this._model.drawables.count,i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1},t.prototype.getDrawableCount=function(){return this._model.drawables.count},t.prototype.getDrawableId=function(t){var e=this._model.drawables.ids;return ft.getIdManager().getId(e[t])},t.prototype.getDrawableRenderOrders=function(){return this._model.drawables.renderOrders},t.prototype.getDrawableTextureIndices=function(t){return this._model.drawables.textureIndices[t]},t.prototype.getDrawableDynamicFlagVertexPositionsDidChange=function(t){var e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])},t.prototype.getDrawableVertexIndexCount=function(t){return this._model.drawables.indexCounts[t]},t.prototype.getDrawableVertexCount=function(t){return this._model.drawables.vertexCounts[t]},t.prototype.getDrawableVertices=function(t){return this.getDrawableVertexPositions(t)},t.prototype.getDrawableVertexIndices=function(t){return this._model.drawables.indices[t]},t.prototype.getDrawableVertexPositions=function(t){return this._model.drawables.vertexPositions[t]},t.prototype.getDrawableVertexUvs=function(t){return this._model.drawables.vertexUvs[t]},t.prototype.getDrawableOpacity=function(t){return this._model.drawables.opacities[t]},t.prototype.getDrawableCulling=function(t){var e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])},t.prototype.getDrawableBlendMode=function(t){var e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?mt.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?mt.CubismBlendMode_Multiplicative:mt.CubismBlendMode_Normal},t.prototype.getDrawableInvertedMaskBit=function(t){var e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])},t.prototype.getDrawableMasks=function(){return this._model.drawables.masks},t.prototype.getDrawableMaskCounts=function(){return this._model.drawables.maskCounts},t.prototype.isUsingMasking=function(){for(var t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1},t.prototype.getDrawableDynamicFlagIsVisible=function(t){var e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])},t.prototype.getDrawableDynamicFlagVisibilityDidChange=function(t){var e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])},t.prototype.getDrawableDynamicFlagOpacityDidChange=function(t){var e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])},t.prototype.getDrawableDynamicFlagRenderOrderDidChange=function(t){var e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])},t.prototype.loadParameters=function(){var t=this._model.parameters.count,e=this._savedParameters.getSize();t>e&&(t=e);for(var i=0;i<t;++i)this._parameterValues[i]=this._savedParameters.at(i)},t.prototype.initialize=function(){m(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;var t=this._model.parameters.ids,e=this._model.parameters.count;this._parameterIds.prepareCapacity(e);for(var i=0;i<e;++i)this._parameterIds.pushBack(ft.getIdManager().getId(t[i]));var r=this._model.parts.ids,n=this._model.parts.count;this._partIds.prepareCapacity(n);for(i=0;i<n;++i)this._partIds.pushBack(ft.getIdManager().getId(r[i]));var o=this._model.drawables.ids,s=this._model.drawables.count;this._drawableIds.prepareCapacity(s);for(i=0;i<s;++i)this._drawableIds.pushBack(ft.getIdManager().getId(o[i]))},t.prototype.release=function(){this._model.release(),this._model=null},t}();t.CubismModel=e}(_t||(_t={}));var St,xt=_t.CubismModel;!function(t){var e=function(){function t(t){this._moc=t,this._modelCount=0}return t.create=function(e){var i=null,r=Live2DCubismCore.Moc.fromArrayBuffer(e);return r&&(i=new t(r)),i},t.delete=function(t){t._moc._release(),t._moc=null,t=null},t.prototype.createModel=function(){var t=null,e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&((t=new xt(e)).initialize(),++this._modelCount),t},t.prototype.deleteModel=function(t){null!=t&&(t.release(),t=null,--this._modelCount)},t.prototype.release=function(){m(0==this._modelCount),this._moc._release(),this._moc=null},t}();t.CubismMoc=e}(St||(St={}));var bt,Ct=r.csmString,Bt=k.CubismFramework,Mt=C.CubismJson;!function(t){var e="Meta",i=function(){function t(t,e){this._json=Mt.create(t,e)}return t.prototype.release=function(){Mt.delete(this._json)},t.prototype.getMotionDuration=function(){return this._json.getRoot().getValueByString(e).getValueByString("Duration").toFloat()},t.prototype.isMotionLoop=function(){return this._json.getRoot().getValueByString(e).getValueByString("Loop").toBoolean()},t.prototype.getMotionCurveCount=function(){return this._json.getRoot().getValueByString(e).getValueByString("CurveCount").toInt()},t.prototype.getMotionFps=function(){return this._json.getRoot().getValueByString(e).getValueByString("Fps").toFloat()},t.prototype.getMotionTotalSegmentCount=function(){return this._json.getRoot().getValueByString(e).getValueByString("TotalSegmentCount").toInt()},t.prototype.getMotionTotalPointCount=function(){return this._json.getRoot().getValueByString(e).getValueByString("TotalPointCount").toInt()},t.prototype.isExistMotionFadeInTime=function(){return!this._json.getRoot().getValueByString(e).getValueByString("FadeInTime").isNull()},t.prototype.isExistMotionFadeOutTime=function(){return!this._json.getRoot().getValueByString(e).getValueByString("FadeOutTime").isNull()},t.prototype.getMotionFadeInTime=function(){return this._json.getRoot().getValueByString(e).getValueByString("FadeInTime").toFloat()},t.prototype.getMotionFadeOutTime=function(){return this._json.getRoot().getValueByString(e).getValueByString("FadeOutTime").toFloat()},t.prototype.getMotionCurveTarget=function(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Target").getRawString()},t.prototype.getMotionCurveId=function(t){return Bt.getIdManager().getId(this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Id").getRawString())},t.prototype.isExistMotionCurveFadeInTime=function(t){return!this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeInTime").isNull()},t.prototype.isExistMotionCurveFadeOutTime=function(t){return!this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeOutTime").isNull()},t.prototype.getMotionCurveFadeInTime=function(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeInTime").toFloat()},t.prototype.getMotionCurveFadeOutTime=function(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("FadeOutTime").toFloat()},t.prototype.getMotionCurveSegmentCount=function(t){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Segments").getVector().getSize()},t.prototype.getMotionCurveSegment=function(t,e){return this._json.getRoot().getValueByString("Curves").getValueByIndex(t).getValueByString("Segments").getValueByIndex(e).toFloat()},t.prototype.getEventCount=function(){return this._json.getRoot().getValueByString(e).getValueByString("UserDataCount").toInt()},t.prototype.getTotalEventValueSize=function(){return this._json.getRoot().getValueByString(e).getValueByString("TotalUserDataSize").toInt()},t.prototype.getEventTime=function(t){return this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Time").toInt()},t.prototype.getEventValue=function(t){return new Ct(this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Value").getRawString())},t}();t.CubismMotionJson=i}(bt||(bt={}));var Pt,wt=_.csmVector;!function(t){var e;!function(t){t[t.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",t[t.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",t[t.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity"}(e=t.CubismMotionCurveTarget||(t.CubismMotionCurveTarget={})),function(t){t[t.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",t[t.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",t[t.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",t[t.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped"}(t.CubismMotionSegmentType||(t.CubismMotionSegmentType={}));var i=function(){this.time=0,this.value=0};t.CubismMotionPoint=i;var r=function(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0};t.CubismMotionSegment=r;var n=function(){this.type=e.CubismMotionCurveTarget_Model,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0};t.CubismMotionCurve=n;var o=function(){this.fireTime=0};t.CubismMotionEvent=o;var s=function(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new wt,this.segments=new wt,this.points=new wt,this.events=new wt};t.CubismMotionData=s}(Pt||(Pt={}));var It,Vt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Tt=r.csmString,Et=Pt.CubismMotionData,Ft=Pt.CubismMotionSegment,Lt=Pt.CubismMotionPoint,Rt=Pt.CubismMotionEvent,At=Pt.CubismMotionSegmentType,kt=Pt.CubismMotionCurve,Dt=Pt.CubismMotionCurveTarget,Nt=Z.CubismMath,Ot=k.CubismFramework,Ut=$.ACubismMotion,zt=bt.CubismMotionJson;!function(t){function e(t,e,i){var r=new Lt;return r.time=t.time+(e.time-t.time)*i,r.value=t.value+(e.value-t.value)*i,r}function i(t,e){var i=(e-t[0].time)/(t[1].time-t[0].time);return i<0&&(i=0),t[0].value+(t[1].value-t[0].value)*i}function r(t,i){var r=(i-t[0].time)/(t[3].time-t[0].time);r<0&&(r=0);var n=e(t[0],t[1],r),o=e(t[1],t[2],r),s=e(t[2],t[3],r),a=e(n,o,r),u=e(o,s,r);return e(a,u,r).value}function n(t,e){return t[0].value}function o(t,e){return t[1].value}function s(t,e,i){for(var r=t.curves.at(e),n=-1,o=r.baseSegmentIndex+r.segmentCount,s=0,a=r.baseSegmentIndex;a<o;++a)if(s=t.segments.at(a).basePointIndex+(t.segments.at(a).segmentType==At.CubismMotionSegmentType_Bezier?3:1),t.points.at(s).time>i){n=a;break}if(-1==n)return t.points.at(s).value;var u=t.segments.at(n);return u.evaluate(t.points.get(u.basePointIndex),i)}var a=function(t){function e(){var e=t.call(this)||this;return e._sourceFrameRate=30,e._loopDurationSeconds=-1,e._isLoop=!1,e._isLoopFadeIn=!0,e._lastWeight=0,e._motionData=null,e._modelCurveIdEyeBlink=null,e._modelCurveIdLipSync=null,e._eyeBlinkParameterIds=null,e._lipSyncParameterIds=null,e}return Vt(e,t),e.create=function(t,i){var r=new e;return r.parse(t,i),r._sourceFrameRate=r._motionData.fps,r._loopDurationSeconds=r._motionData.duration,r},e.prototype.doUpdateParameters=function(t,e,i,r){null==this._modelCurveIdEyeBlink&&(this._modelCurveIdEyeBlink=Ot.getIdManager().getId("EyeBlink")),null==this._modelCurveIdLipSync&&(this._modelCurveIdLipSync=Ot.getIdManager().getId("LipSync"));var n=e-r.getStartTime();n<0&&(n=0);var o=Number.MAX_VALUE,a=Number.MAX_VALUE,u=0,l=0;this._eyeBlinkParameterIds.getSize()>64&&y("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>64&&y("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());var h,p,c,g=this._fadeInSeconds<=0?1:Nt.getEasingSine((e-r.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||r.getEndTime()<0?1:Nt.getEasingSine((r.getEndTime()-e)/this._fadeOutSeconds),_=n;if(this._isLoop)for(;_>this._motionData.duration;)_-=this._motionData.duration;var f=this._motionData.curves;for(p=0;p<this._motionData.curveCount&&f.at(p).type==Dt.CubismMotionCurveTarget_Model;++p)h=s(this._motionData,p,_),f.at(p).id==this._modelCurveIdEyeBlink?a=h:f.at(p).id==this._modelCurveIdLipSync&&(o=h);for(;p<this._motionData.curveCount&&f.at(p).type==Dt.CubismMotionCurveTarget_Parameter;++p)if(-1!=(c=t.getParameterIndex(f.at(p).id))){var m=t.getParameterValueByIndex(c);if(h=s(this._motionData,p,_),a!=Number.MAX_VALUE)for(var v=0;v<this._eyeBlinkParameterIds.getSize()&&v<64;++v)if(this._eyeBlinkParameterIds.at(v)==f.at(p).id){h*=a,l|=1<<v;break}if(o!=Number.MAX_VALUE)for(v=0;v<this._lipSyncParameterIds.getSize()&&v<64;++v)if(this._lipSyncParameterIds.at(v)==f.at(p).id){h+=o,u|=1<<v;break}var S=void 0;if(f.at(p).fadeInTime<0&&f.at(p).fadeOutTime<0)S=m+(h-m)*i;else{var x=void 0,b=void 0;x=f.at(p).fadeInTime<0?g:0==f.at(p).fadeInTime?1:Nt.getEasingSine((e-r.getFadeInStartTime())/f.at(p).fadeInTime),b=f.at(p).fadeOutTime<0?d:0==f.at(p).fadeOutTime||r.getEndTime()<0?1:Nt.getEasingSine((r.getEndTime()-e)/f.at(p).fadeOutTime),S=m+(h-m)*(this._weight*x*b)}t.setParameterValueByIndex(c,S,1)}if(a!=Number.MAX_VALUE)for(v=0;v<this._eyeBlinkParameterIds.getSize()&&v<64;++v){m=t.getParameterValueById(this._eyeBlinkParameterIds.at(v));if(!(l>>v&1)){S=m+(a-m)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(v),S)}}if(o!=Number.MAX_VALUE)for(v=0;v<this._lipSyncParameterIds.getSize()&&v<64;++v){m=t.getParameterValueById(this._lipSyncParameterIds.at(v));if(!(u>>v&1)){S=m+(o-m)*i;t.setParameterValueById(this._lipSyncParameterIds.at(v),S)}}for(;p<this._motionData.curveCount&&f.at(p).type==Dt.CubismMotionCurveTarget_PartOpacity;++p)-1!=(c=t.getParameterIndex(f.at(p).id))&&(h=s(this._motionData,p,_),t.setParameterValueByIndex(c,h));n>=this._motionData.duration&&(this._isLoop?(r.setStartTime(e),this._isLoopFadeIn&&r.setFadeInStartTime(e)):r.setIsFinished(!0)),this._lastWeight=i},e.prototype.setIsLoop=function(t){this._isLoop=t},e.prototype.isLoop=function(){return this._isLoop},e.prototype.setIsLoopFadeIn=function(t){this._isLoopFadeIn=t},e.prototype.isLoopFadeIn=function(){return this._isLoopFadeIn},e.prototype.getDuration=function(){return this._isLoop?-1:this._loopDurationSeconds},e.prototype.getLoopDuration=function(){return this._loopDurationSeconds},e.prototype.setParameterFadeInTime=function(t,e){for(var i=this._motionData.curves,r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id)return void(i.at(r).fadeInTime=e)},e.prototype.setParameterFadeOutTime=function(t,e){for(var i=this._motionData.curves,r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id)return void(i.at(r).fadeOutTime=e)},e.prototype.getParameterFadeInTime=function(t){for(var e=this._motionData.curves,i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1},e.prototype.getParameterFadeOutTime=function(t){for(var e=this._motionData.curves,i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1},e.prototype.setEffectIds=function(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e},e.prototype.release=function(){this._motionData=void 0,this._motionData=null},e.prototype.parse=function(t,e){this._motionData=new Et;var s=new zt(t,e);this._motionData.duration=s.getMotionDuration(),this._motionData.loop=s.isMotionLoop(),this._motionData.curveCount=s.getMotionCurveCount(),this._motionData.fps=s.getMotionFps(),this._motionData.eventCount=s.getEventCount(),s.isExistMotionFadeInTime()?this._fadeInSeconds=s.getMotionFadeInTime()<0?1:s.getMotionFadeInTime():this._fadeInSeconds=1,s.isExistMotionFadeOutTime()?this._fadeOutSeconds=s.getMotionFadeOutTime()<0?1:s.getMotionFadeOutTime():this._fadeOutSeconds=1;for(var a=0,u=0,l=0;l<this._motionData.curveCount;++l){var h=new kt;"Model"==s.getMotionCurveTarget(l)?h.type=Dt.CubismMotionCurveTarget_Model:"Parameter"==s.getMotionCurveTarget(l)?h.type=Dt.CubismMotionCurveTarget_Parameter:"PartOpacity"==s.getMotionCurveTarget(l)&&(h.type=Dt.CubismMotionCurveTarget_PartOpacity),h.id=s.getMotionCurveId(l),h.baseSegmentIndex=u,h.fadeInTime=s.isExistMotionCurveFadeInTime(l)?s.getMotionCurveFadeInTime(l):-1,h.fadeOutTime=s.isExistMotionCurveFadeOutTime(l)?s.getMotionCurveFadeOutTime(l):-1;for(var p=0;p<s.getMotionCurveSegmentCount(l);){var c=new Ft;if(0==p){var g=new Lt;c.basePointIndex=a,g.time=s.getMotionCurveSegment(l,p),g.value=s.getMotionCurveSegment(l,p+1),this._motionData.points.pushBack(g),a+=1,p+=2}else c.basePointIndex=a-1;switch(s.getMotionCurveSegment(l,p)){case At.CubismMotionSegmentType_Linear:g=new Lt;c.segmentType=At.CubismMotionSegmentType_Linear,c.evaluate=i,g.time=s.getMotionCurveSegment(l,p+1),g.value=s.getMotionCurveSegment(l,p+2),this._motionData.points.pushBack(g),a+=1,p+=3;break;case At.CubismMotionSegmentType_Bezier:g=void 0;c.segmentType=At.CubismMotionSegmentType_Bezier,c.evaluate=r,(g=new Lt).time=s.getMotionCurveSegment(l,p+1),g.value=s.getMotionCurveSegment(l,p+2),this._motionData.points.pushBack(g),(g=new Lt).time=s.getMotionCurveSegment(l,p+3),g.value=s.getMotionCurveSegment(l,p+4),this._motionData.points.pushBack(g),(g=new Lt).time=s.getMotionCurveSegment(l,p+5),g.value=s.getMotionCurveSegment(l,p+6),this._motionData.points.pushBack(g),a+=3,p+=7;break;case At.CubismMotionSegmentType_Stepped:g=new Lt;c.segmentType=At.CubismMotionSegmentType_Stepped,c.evaluate=n,g.time=s.getMotionCurveSegment(l,p+1),g.value=s.getMotionCurveSegment(l,p+2),this._motionData.points.pushBack(g),a+=1,p+=3;break;case At.CubismMotionSegmentType_InverseStepped:g=new Lt;c.segmentType=At.CubismMotionSegmentType_InverseStepped,c.evaluate=o,g.time=s.getMotionCurveSegment(l,p+1),g.value=s.getMotionCurveSegment(l,p+2),this._motionData.points.pushBack(g),a+=1,p+=3;break;default:m(0)}++h.segmentCount,++u,this._motionData.segments.pushBack(c)}this._motionData.curves.pushBack(h)}for(var d=0;d<s.getEventCount();++d){var _=new Rt;_.fireTime=s.getEventTime(d),_.value=s.getEventValue(d),this._motionData.events.pushBack(_)}s.release(),s=void 0,s=null},e.prototype.getFiredEvent=function(t,e){this._firedEventValues.updateSize(0);for(var i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new Tt(this._motionData.events.at(i).value.s));return this._firedEventValues},e}(Ut);t.CubismMotion=a}(It||(It={}));var jt,Xt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Yt=_.csmVector,Gt=k.CubismFramework,qt=C.CubismJson,Ht=$.ACubismMotion;!function(t){var e,i=function(t){function i(){var e=t.call(this)||this;return e._parameters=new Yt,e}return Xt(i,t),i.create=function(t,n){var o=new i,s=qt.create(t,n),a=s.getRoot();o.setFadeInTime(a.getValueByString("FadeInTime").toFloat(1)),o.setFadeOutTime(a.getValueByString("FadeOutTime").toFloat(1));var u=a.getValueByString("Parameters").getSize();o._parameters.prepareCapacity(u);for(var l=0;l<u;++l){var h=a.getValueByString("Parameters").getValueByIndex(l),p=Gt.getIdManager().getId(h.getValueByString("Id").getRawString()),c=h.getValueByString("Value").toFloat(),g=void 0;g=h.getValueByString("Blend").isNull()||"Add"==h.getValueByString("Blend").getString()?e.ExpressionBlendType_Add:"Multiply"==h.getValueByString("Blend").getString()?e.ExpressionBlendType_Multiply:"Overwrite"==h.getValueByString("Blend").getString()?e.ExpressionBlendType_Overwrite:e.ExpressionBlendType_Add;var d=new r;d.parameterId=p,d.blendType=g,d.value=c,o._parameters.pushBack(d)}return qt.delete(s),o},i.prototype.doUpdateParameters=function(t,i,r,n){for(var o=0;o<this._parameters.getSize();++o){var s=this._parameters.at(o);switch(s.blendType){case e.ExpressionBlendType_Add:t.addParameterValueById(s.parameterId,s.value,r);break;case e.ExpressionBlendType_Multiply:t.multiplyParameterValueById(s.parameterId,s.value,r);break;case e.ExpressionBlendType_Overwrite:t.setParameterValueById(s.parameterId,s.value,r)}}},i}(Ht);t.CubismExpressionMotion=i,function(t){t[t.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",t[t.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",t[t.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite"}(e=t.ExpressionBlendType||(t.ExpressionBlendType={}));var r=function(){};t.ExpressionParameter=r}(jt||(jt={}));var Wt,Jt=_.csmVector,Kt=k.CubismFramework,Zt=C.CubismJson;!function(t){var e=function(){function t(){this._fadeTimeSeconds=.5,this._lastModel=null,this._partGroups=new Jt,this._partGroupCounts=new Jt}return t.create=function(e,r){var n=new t,o=Zt.create(e,r),s=o.getRoot();s.getValueByString("FadeInTime").isNull()||(n._fadeTimeSeconds=s.getValueByString("FadeInTime").toFloat(.5),n._fadeTimeSeconds<=0&&(n._fadeTimeSeconds=.5));for(var a=s.getValueByString("Groups"),u=a.getSize(),l=0;l<u;++l){for(var h=a.getValueByIndex(l),p=h.getSize(),c=0,g=0;g<p;++g){var d=h.getValueByIndex(g),_=new i,f=Kt.getIdManager().getId(d.getValueByString("Id").getRawString());if(_.partId=f,!d.getValueByString("Link").isNull())for(var m=d.getValueByString("Link"),y=m.getSize(),v=0;v<y;++v){var S=new i,x=Kt.getIdManager().getId(m.getValueByIndex(v).getString());S.partId=x,_.link.pushBack(S)}n._partGroups.pushBack(_.clone()),++c}n._partGroupCounts.pushBack(c)}return Zt.delete(o),n},t.delete=function(t){null!=t&&(t=null)},t.prototype.updateParameters=function(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);for(var i=0,r=0;r<this._partGroupCounts.getSize();r++){var n=this._partGroupCounts.at(r);this.doFade(t,e,i,n),i+=n}this.copyPartOpacities(t)},t.prototype.reset=function(t){for(var e=0,i=0;i<this._partGroupCounts.getSize();++i){for(var r=this._partGroupCounts.at(i),n=e;n<e+r;++n){this._partGroups.at(n).initialize(t);var o=this._partGroups.at(n).partIndex,s=this._partGroups.at(n).parameterIndex;if(!(o<0)){t.setPartOpacityByIndex(o,n==e?1:0),t.setParameterValueByIndex(s,n==e?1:0);for(var a=0;a<this._partGroups.at(n).link.getSize();++a)this._partGroups.at(n).link.at(a).initialize(t)}}e+=r}},t.prototype.copyPartOpacities=function(t){for(var e=0;e<this._partGroups.getSize();++e){var i=this._partGroups.at(e);if(0!=i.link.getSize())for(var r=this._partGroups.at(e).partIndex,n=t.getPartOpacityByIndex(r),o=0;o<i.link.getSize();++o){var s=i.link.at(o).partIndex;s<0||t.setPartOpacityByIndex(s,n)}}},t.prototype.doFade=function(t,e,i,r){for(var n=-1,o=1,s=i;s<i+r;++s){var a=this._partGroups.at(s).partIndex,u=this._partGroups.at(s).parameterIndex;if(t.getParameterValueByIndex(u)>.001){if(n>=0)break;n=s,o=t.getPartOpacityByIndex(a),(o+=e/this._fadeTimeSeconds)>1&&(o=1)}}n<0&&(n=0,o=1);for(s=i;s<i+r;++s){var l=this._partGroups.at(s).partIndex;if(n==s)t.setPartOpacityByIndex(l,o);else{var h=t.getPartOpacityByIndex(l),p=void 0;(1-(p=o<.5?-.5*o/.5+1:.5*(1-o)/.5))*(1-o)>.15&&(p=1-.15/(1-o)),h>p&&(h=p),t.setPartOpacityByIndex(l,h)}}},t}();t.CubismPose=e;var i=function(){function t(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new Jt,null!=t){this.partId=t.partId;for(var e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}return t.prototype.assignment=function(t){this.partId=t.partId;for(var e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this},t.prototype.initialize=function(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)},t.prototype.clone=function(){var e=new t;e.partId=this.partId,e.parameterIndex=this.parameterIndex,e.partIndex=this.partIndex,e.link=new Jt;for(var i=this.link.begin();i.notEqual(this.link.end());i.increment())e.link.pushBack(i.ptr().clone());return e},t}();t.PartData=i}(Wt||(Wt={}));var Qt,$t=k.CubismFramework,te=C.CubismJson;!function(t){var e=function(){function t(t,e){this._json=te.create(t,e)}return t.prototype.release=function(){te.delete(this._json)},t.prototype.getUserDataCount=function(){return this._json.getRoot().getValueByString("Meta").getValueByString("UserDataCount").toInt()},t.prototype.getTotalUserDataSize=function(){return this._json.getRoot().getValueByString("Meta").getValueByString("TotalUserDataSize").toInt()},t.prototype.getUserDataTargetType=function(t){return this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Target").getRawString()},t.prototype.getUserDataId=function(t){return $t.getIdManager().getId(this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Id").getRawString())},t.prototype.getUserDataValue=function(t){return this._json.getRoot().getValueByString("UserData").getValueByIndex(t).getValueByString("Value").getRawString()},t}();t.CubismModelUserDataJson=e}(Qt||(Qt={}));var ee,ie=k.CubismFramework,re=_.csmVector,ne=r.csmString,oe=Qt.CubismModelUserDataJson;!function(t){var e=function(){};t.CubismModelUserDataNode=e;var i=function(){function t(){this._userDataNodes=new re,this._artMeshUserDataNode=new re}return t.create=function(e,i){var r=new t;return r.parseUserData(e,i),r},t.delete=function(t){null!=t&&(t.release(),t=null)},t.prototype.getArtMeshUserDatas=function(){return this._artMeshUserDataNode},t.prototype.parseUserData=function(t,i){for(var r=new oe(t,i),n=ie.getIdManager().getId("ArtMesh"),o=r.getUserDataCount(),s=0;s<o;s++){var a=new e;a.targetId=r.getUserDataId(s),a.targetType=ie.getIdManager().getId(r.getUserDataTargetType(s)),a.value=new ne(r.getUserDataValue(s)),this._userDataNodes.pushBack(a),a.targetType==n&&this._artMeshUserDataNode.pushBack(a)}r.release(),r=void 0},t.prototype.release=function(){for(var t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null},t}();t.CubismModelUserData=i}(ee||(ee={}));var se,ae=_.csmVector,ue=X.CubismVector2;!function(t){!function(t){t[t.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter"}(t.CubismPhysicsTargetType||(t.CubismPhysicsTargetType={})),function(t){t[t.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",t[t.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",t[t.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle"}(t.CubismPhysicsSource||(t.CubismPhysicsSource={}));var e=function(){this.gravity=new ue(0,0),this.wind=new ue(0,0)};t.PhysicsJsonEffectiveForces=e;var i=function(){};t.CubismPhysicsParameter=i;var r=function(){};t.CubismPhysicsNormalization=r;var n=function(){this.initialPosition=new ue(0,0),this.position=new ue(0,0),this.lastPosition=new ue(0,0),this.lastGravity=new ue(0,0),this.force=new ue(0,0),this.velocity=new ue(0,0)};t.CubismPhysicsParticle=n;var o=function(){this.normalizationPosition=new r,this.normalizationAngle=new r};t.CubismPhysicsSubRig=o;var s=function(){this.source=new i};t.CubismPhysicsInput=s;var a=function(){this.destination=new i,this.translationScale=new ue(0,0)};t.CubismPhysicsOutput=a;var u=function(){this.settings=new ae,this.inputs=new ae,this.outputs=new ae,this.particles=new ae,this.gravity=new ue(0,0),this.wind=new ue(0,0)};t.CubismPhysicsRig=u}(se||(se={}));var le,he=k.CubismFramework,pe=X.CubismVector2,ce=C.CubismJson;!function(t){var e="Meta",i="PhysicsSettings",r=function(){function t(t,e){this._json=ce.create(t,e)}return t.prototype.release=function(){ce.delete(this._json)},t.prototype.getGravity=function(){var t=new pe(0,0);return t.x=this._json.getRoot().getValueByString(e).getValueByString("EffectiveForces").getValueByString("Gravity").getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString(e).getValueByString("EffectiveForces").getValueByString("Gravity").getValueByString("Y").toFloat(),t},t.prototype.getWind=function(){var t=new pe(0,0);return t.x=this._json.getRoot().getValueByString(e).getValueByString("EffectiveForces").getValueByString("Wind").getValueByString("X").toFloat(),t.y=this._json.getRoot().getValueByString(e).getValueByString("EffectiveForces").getValueByString("Wind").getValueByString("Y").toFloat(),t},t.prototype.getSubRigCount=function(){return this._json.getRoot().getValueByString(e).getValueByString("PhysicsSettingCount").toInt()},t.prototype.getTotalInputCount=function(){return this._json.getRoot().getValueByString(e).getValueByString("TotalInputCount").toInt()},t.prototype.getTotalOutputCount=function(){return this._json.getRoot().getValueByString(e).getValueByString("TotalOutputCount").toInt()},t.prototype.getVertexCount=function(){return this._json.getRoot().getValueByString(e).getValueByString("VertexCount").toInt()},t.prototype.getNormalizationPositionMinimumValue=function(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Position").getValueByString("Minimum").toFloat()},t.prototype.getNormalizationPositionMaximumValue=function(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Position").getValueByString("Maximum").toFloat()},t.prototype.getNormalizationPositionDefaultValue=function(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Position").getValueByString("Default").toFloat()},t.prototype.getNormalizationAngleMinimumValue=function(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Angle").getValueByString("Minimum").toFloat()},t.prototype.getNormalizationAngleMaximumValue=function(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Angle").getValueByString("Maximum").toFloat()},t.prototype.getNormalizationAngleDefaultValue=function(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Normalization").getValueByString("Angle").getValueByString("Default").toFloat()},t.prototype.getInputCount=function(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getVector().getSize()},t.prototype.getInputWeight=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Weight").toFloat()},t.prototype.getInputReflect=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Reflect").toBoolean()},t.prototype.getInputType=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Type").getRawString()},t.prototype.getInputSourceId=function(t,e){return he.getIdManager().getId(this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Input").getValueByIndex(e).getValueByString("Source").getValueByString("Id").getRawString())},t.prototype.getOutputCount=function(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getVector().getSize()},t.prototype.getOutputVertexIndex=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("VertexIndex").toInt()},t.prototype.getOutputAngleScale=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Scale").toFloat()},t.prototype.getOutputWeight=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Weight").toFloat()},t.prototype.getOutputDestinationId=function(t,e){return he.getIdManager().getId(this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Destination").getValueByString("Id").getRawString())},t.prototype.getOutputType=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Type").getRawString()},t.prototype.getOutputReflect=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Output").getValueByIndex(e).getValueByString("Reflect").toBoolean()},t.prototype.getParticleCount=function(t){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getVector().getSize()},t.prototype.getParticleMobility=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Mobility").toFloat()},t.prototype.getParticleDelay=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Delay").toFloat()},t.prototype.getParticleAcceleration=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Acceleration").toFloat()},t.prototype.getParticleRadius=function(t,e){return this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Radius").toInt()},t.prototype.getParticlePosition=function(t,e){var r=new pe(0,0);return r.x=this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Position").getValueByString("X").toFloat(),r.y=this._json.getRoot().getValueByString(i).getValueByIndex(t).getValueByString("Vertices").getValueByIndex(e).getValueByString("Position").getValueByString("Y").toFloat(),r},t}();t.CubismPhysicsJson=r}(le||(le={}));var ge,de,_e=le.CubismPhysicsJson,fe=Z.CubismMath,me=se.CubismPhysicsRig,ye=se.CubismPhysicsSubRig,ve=se.CubismPhysicsInput,Se=se.CubismPhysicsOutput,xe=se.CubismPhysicsParticle,be=se.CubismPhysicsSource,Ce=se.CubismPhysicsTargetType,Be=X.CubismVector2;!function(t){var e=function(){function t(){this._physicsRig=null,this._options=new i,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0}return t.create=function(e,i){var r=new t;return r.parse(e,i),r._physicsRig.gravity.y=0,r},t.delete=function(t){null!=t&&(t.release(),t=null)},t.prototype.evaluate=function(t,e){var i,r,n,o,s,a,u,l,h,p,c,_,f=new Be;h=t.getModel().parameters.values,p=t.getModel().parameters.maximumValues,c=t.getModel().parameters.minimumValues,_=t.getModel().parameters.defaultValues;for(var m=0;m<this._physicsRig.subRigCount;++m){i={angle:0},f.x=0,f.y=0,s=this._physicsRig.settings.at(m),a=this._physicsRig.inputs.get(s.baseInputIndex),u=this._physicsRig.outputs.get(s.baseOutputIndex),l=this._physicsRig.particles.get(s.baseParticleIndex);for(var y=0;y<s.inputCount;++y)r=a[y].weight/100,-1==a[y].sourceParameterIndex&&(a[y].sourceParameterIndex=t.getParameterIndex(a[y].source.id)),a[y].getNormalizedParameterValue(f,i,h[a[y].sourceParameterIndex],c[a[y].sourceParameterIndex],p[a[y].sourceParameterIndex],_[a[y].sourceParameterIndex],s.normalizationPosition,s.normalizationAngle,a[0].reflect,r);n=fe.degreesToRadian(-i.angle),f.x=f.x*fe.cos(n)-f.y*fe.sin(n),f.y=f.x*fe.sin(n)+f.y*fe.cos(n),g(l,s.particleCount,f,i.angle,this._options.wind,.001*s.normalizationPosition.maximum,e,5);for(y=0;y<s.outputCount;++y){var v=u[y].vertexIndex;if(v<1||v>=s.particleCount)break;-1==u[y].destinationParameterIndex&&(u[y].destinationParameterIndex=t.getParameterIndex(u[y].destination.id));var S=new Be;S.x=l[v].position.x-l[v-1].position.x,S.y=l[v].position.y-l[v-1].position.y,o=u[y].getValue(S,l,v,u[y].reflect,this._options.gravity);var x=u[y].destinationParameterIndex,b=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(h.subarray(x))):h.slice(x);d(b,c[x],p[x],o,u[y]);for(var C=x,B=0;C<h.length;C++,B++)h[C]=b[B]}}},t.prototype.setOptions=function(t){this._options=t},t.prototype.getOption=function(){return this._options},t.prototype.release=function(){this._physicsRig=void 0,this._physicsRig=null},t.prototype.parse=function(t,e){this._physicsRig=new me;var i=new _e(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,ye,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),ve,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),Se,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),xe,!0);for(var l=0,g=0,d=0,_=0;_<this._physicsRig.settings.getSize();++_){this._physicsRig.settings.at(_).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(_),this._physicsRig.settings.at(_).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(_),this._physicsRig.settings.at(_).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(_),this._physicsRig.settings.at(_).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(_),this._physicsRig.settings.at(_).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(_),this._physicsRig.settings.at(_).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(_),this._physicsRig.settings.at(_).inputCount=i.getInputCount(_),this._physicsRig.settings.at(_).baseInputIndex=l;for(var f=0;f<this._physicsRig.settings.at(_).inputCount;++f)this._physicsRig.inputs.at(l+f).sourceParameterIndex=-1,this._physicsRig.inputs.at(l+f).weight=i.getInputWeight(_,f),this._physicsRig.inputs.at(l+f).reflect=i.getInputReflect(_,f),"X"==i.getInputType(_,f)?(this._physicsRig.inputs.at(l+f).type=be.CubismPhysicsSource_X,this._physicsRig.inputs.at(l+f).getNormalizedParameterValue=r):"Y"==i.getInputType(_,f)?(this._physicsRig.inputs.at(l+f).type=be.CubismPhysicsSource_Y,this._physicsRig.inputs.at(l+f).getNormalizedParameterValue=n):"Angle"==i.getInputType(_,f)&&(this._physicsRig.inputs.at(l+f).type=be.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(l+f).getNormalizedParameterValue=o),this._physicsRig.inputs.at(l+f).source.targetType=Ce.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(l+f).source.id=i.getInputSourceId(_,f);l+=this._physicsRig.settings.at(_).inputCount,this._physicsRig.settings.at(_).outputCount=i.getOutputCount(_),this._physicsRig.settings.at(_).baseOutputIndex=g;for(f=0;f<this._physicsRig.settings.at(_).outputCount;++f)this._physicsRig.outputs.at(g+f).destinationParameterIndex=-1,this._physicsRig.outputs.at(g+f).vertexIndex=i.getOutputVertexIndex(_,f),this._physicsRig.outputs.at(g+f).angleScale=i.getOutputAngleScale(_,f),this._physicsRig.outputs.at(g+f).weight=i.getOutputWeight(_,f),this._physicsRig.outputs.at(g+f).destination.targetType=Ce.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(g+f).destination.id=i.getOutputDestinationId(_,f),"X"==i.getOutputType(_,f)?(this._physicsRig.outputs.at(g+f).type=be.CubismPhysicsSource_X,this._physicsRig.outputs.at(g+f).getValue=s,this._physicsRig.outputs.at(g+f).getScale=h):"Y"==i.getOutputType(_,f)?(this._physicsRig.outputs.at(g+f).type=be.CubismPhysicsSource_Y,this._physicsRig.outputs.at(g+f).getValue=a,this._physicsRig.outputs.at(g+f).getScale=p):"Angle"==i.getOutputType(_,f)&&(this._physicsRig.outputs.at(g+f).type=be.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(g+f).getValue=u,this._physicsRig.outputs.at(g+f).getScale=c),this._physicsRig.outputs.at(g+f).reflect=i.getOutputReflect(_,f);g+=this._physicsRig.settings.at(_).outputCount,this._physicsRig.settings.at(_).particleCount=i.getParticleCount(_),this._physicsRig.settings.at(_).baseParticleIndex=d;for(f=0;f<this._physicsRig.settings.at(_).particleCount;++f)this._physicsRig.particles.at(d+f).mobility=i.getParticleMobility(_,f),this._physicsRig.particles.at(d+f).delay=i.getParticleDelay(_,f),this._physicsRig.particles.at(d+f).acceleration=i.getParticleAcceleration(_,f),this._physicsRig.particles.at(d+f).radius=i.getParticleRadius(_,f),this._physicsRig.particles.at(d+f).position=i.getParticlePosition(_,f);d+=this._physicsRig.settings.at(_).particleCount}this.initialize(),i.release(),i=void 0,i=null},t.prototype.initialize=function(){for(var t,e,i,r=0;r<this._physicsRig.subRigCount;++r){e=this._physicsRig.settings.at(r),(t=this._physicsRig.particles.get(e.baseParticleIndex))[0].initialPosition=new Be(0,0),t[0].lastPosition=new Be(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new Be(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new Be(0,0),t[0].force=new Be(0,0);for(var n=1;n<e.particleCount;++n)(i=new Be(0,0)).y=t[n].radius,t[n].initialPosition=new Be(t[n-1].initialPosition.x+i.x,t[n-1].initialPosition.y+i.y),t[n].position=new Be(t[n].initialPosition.x,t[n].initialPosition.y),t[n].lastPosition=new Be(t[n].initialPosition.x,t[n].initialPosition.y),t[n].lastGravity=new Be(0,-1),t[n].lastGravity.y*=-1,t[n].velocity=new Be(0,0),t[n].force=new Be(0,0)}},t}();t.CubismPhysics=e;var i=function(){this.gravity=new Be(0,0),this.wind=new Be(0,0)};function r(t,e,i,r,n,o,s,a,u,l){t.x+=_(i,r,n,o,s.minimum,s.maximum,s.defalut,u)*l}function n(t,e,i,r,n,o,s,a,u,l){t.y+=_(i,r,n,o,s.minimum,s.maximum,s.defalut,u)*l}function o(t,e,i,r,n,o,s,a,u,l){e.angle+=_(i,r,n,o,a.minimum,a.maximum,a.defalut,u)*l}function s(t,e,i,r,n){var o=t.x;return r&&(o*=-1),o}function a(t,e,i,r,n){var o=t.y;return r&&(o*=-1),o}function u(t,e,i,r,n){var o;return n=i>=2?e[i-1].position.substract(e[i-2].position):n.multiplyByScaler(-1),o=fe.directionToRadian(n,t),r&&(o*=-1),o}function l(t,e){return fe.min(t,e)+function(t,e){var i=fe.max(t,e),r=fe.min(t,e);return fe.abs(i-r)}(t,e)/2}function h(t,e){return JSON.parse(JSON.stringify(t.x))}function p(t,e){return JSON.parse(JSON.stringify(t.y))}function c(t,e){return JSON.parse(JSON.stringify(e))}function g(t,e,i,r,n,o,s,a){var u,l,h,p,c=new Be(0,0),g=new Be(0,0),d=new Be(0,0),_=new Be(0,0);t[0].position=new Be(i.x,i.y),u=fe.degreesToRadian(r),(p=fe.radianToDirection(u)).normalize();for(var f=1;f<e;++f)t[f].force=p.multiplyByScaler(t[f].acceleration).add(n),t[f].lastPosition=new Be(t[f].position.x,t[f].position.y),l=t[f].delay*s*30,c=t[f].position.substract(t[f-1].position),h=fe.directionToRadian(t[f].lastGravity,p)/a,c.x=fe.cos(h)*c.x-c.y*fe.sin(h),c.y=fe.sin(h)*c.x+c.y*fe.cos(h),t[f].position=t[f-1].position.add(c),g=t[f].velocity.multiplyByScaler(l),d=t[f].force.multiplyByScaler(l).multiplyByScaler(l),t[f].position=t[f].position.add(g).add(d),(_=t[f].position.substract(t[f-1].position)).normalize(),t[f].position=t[f-1].position.add(_.multiplyByScaler(t[f].radius)),fe.abs(t[f].position.x)<o&&(t[f].position.x=0),0!=l&&(t[f].velocity=t[f].position.substract(t[f].lastPosition),t[f].velocity=t[f].velocity.divisionByScalar(l),t[f].velocity=t[f].velocity.multiplyByScaler(t[f].mobility)),t[f].force=new Be(0,0),t[f].lastGravity=new Be(p.x,p.y)}function d(t,e,i,r,n){var o,s;(o=r*n.getScale(n.translationScale,n.angleScale))<e?(o<n.valueBelowMinimum&&(n.valueBelowMinimum=o),o=e):o>i&&(o>n.valueExceededMaximum&&(n.valueExceededMaximum=o),o=i),(s=n.weight/100)>=1?t[0]=o:(o=t[0]*(1-s)+o*s,t[0]=o)}function _(t,e,i,r,n,o,s,a){var u=0,h=fe.max(i,e);h<t&&(t=h);var p=fe.min(i,e);p>t&&(t=p);var c=fe.min(n,o),g=fe.max(n,o),d=s,_=l(p,h),f=t-_;switch(function(t){var e=0;return t>0?e=1:t<0&&(e=-1),e}(f)){case 1:var m=g-d;0!=(y=h-_)&&(u=f*(m/y),u+=d);break;case-1:var y;m=c-d;0!=(y=p-_)&&(u=f*(m/y),u+=d);break;case 0:u=d}return a?u:-1*u}t.Options=i}(ge||(ge={})),function(t){var e=function(){function t(){this._currentTime=0}return t.create=function(){return new t},t.delete=function(t){null!=t&&(t=null)},t.prototype.setParameters=function(t){this._breathParameters=t},t.prototype.getParameters=function(){return this._breathParameters},t.prototype.updateParameters=function(t,e){this._currentTime+=e;for(var i=2*this._currentTime*3.14159,r=0;r<this._breathParameters.getSize();++r){var n=this._breathParameters.at(r);t.addParameterValueById(n.parameterId,n.offset+n.peak*Math.sin(i/n.cycle),n.weight)}},t}();t.CubismBreath=e;var i=function(t,e,i,r,n){this.parameterId=null==t?null:t,this.offset=null==e?0:e,this.peak=null==i?0:i,this.cycle=null==r?0:r,this.weight=null==n?0:n};t.BreathParameterData=i}(de||(de={}));var Me,Pe,we=_.csmVector;!function(t){var e,i=function(){function t(t){if(this._blinkingState=e.EyeState_First,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new we,null!=t)for(var i=0;i<t.getEyeBlinkParameterCount();++i)this._parameterIds.pushBack(t.getEyeBlinkParameterId(i))}return t.create=function(e){return void 0===e&&(e=null),new t(e)},t.delete=function(t){null!=t&&(t=null)},t.prototype.setBlinkingInterval=function(t){this._blinkingIntervalSeconds=t},t.prototype.setBlinkingSetting=function(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i},t.prototype.setParameterIds=function(t){this._parameterIds=t},t.prototype.getParameterIds=function(){return this._parameterIds},t.prototype.updateParameters=function(i,r){var n;this._userTimeSeconds+=r;var o=0;switch(this._blinkingState){case e.EyeState_Closing:(o=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds)>=1&&(o=1,this._blinkingState=e.EyeState_Closed,this._stateStartTimeSeconds=this._userTimeSeconds),n=1-o;break;case e.EyeState_Closed:(o=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds)>=1&&(this._blinkingState=e.EyeState_Opening,this._stateStartTimeSeconds=this._userTimeSeconds),n=0;break;case e.EyeState_Opening:(o=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds)>=1&&(o=1,this._blinkingState=e.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming()),n=o;break;case e.EyeState_Interval:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=e.EyeState_Closing,this._stateStartTimeSeconds=this._userTimeSeconds),n=1;break;case e.EyeState_First:default:this._blinkingState=e.EyeState_Interval,this._nextBlinkingTime=this.determinNextBlinkingTiming(),n=1}t.CloseIfZero||(n=-n);for(var s=0;s<this._parameterIds.getSize();++s)i.setParameterValueById(this._parameterIds.at(s),n)},t.prototype.determinNextBlinkingTiming=function(){var t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)},t.CloseIfZero=!0,t}();t.CubismEyeBlink=i,function(t){t[t.EyeState_First=0]="EyeState_First",t[t.EyeState_Interval=1]="EyeState_Interval",t[t.EyeState_Closing=2]="EyeState_Closing",t[t.EyeState_Closed=3]="EyeState_Closed",t[t.EyeState_Opening=4]="EyeState_Opening"}(e=t.EyeState||(t.EyeState={}))}(Me||(Me={})),function(t){var e=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}return t.prototype.getCenterX=function(){return this.x+.5*this.width},t.prototype.getCenterY=function(){return this.y+.5*this.height},t.prototype.getRight=function(){return this.x+this.width},t.prototype.getBottom=function(){return this.y+this.height},t.prototype.setRect=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.expand=function(t,e){this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e},t}();t.csmRect=e}(Pe||(Pe={}));var Ie,Ve=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Te=k.Constant,Ee=E.CubismMatrix44,Fe=Pe.csmRect,Le=d.csmMap,Re=_.csmVector,Ae=R.CubismRenderer,ke=R.CubismBlendMode,De=R.CubismTextureColor;!function(t){var e,i,r,n=function(){function t(){this._maskRenderTexture=null,this._colorBuffer=null,this._currentFrameNo=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new Re,this._clippingContextListForDraw=new Re,this._channelColors=new Re,this._tmpBoundsOnModel=new Fe,this._tmpMatrix=new Ee,this._tmpMatrixForMask=new Ee,this._tmpMatrixForDraw=new Ee,this._maskTexture=null;var t=new De;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.pushBack(t),(t=new De).R=0,t.G=1,t.B=0,t.A=0,this._channelColors.pushBack(t),(t=new De).R=0,t.G=0,t.B=1,t.A=0,this._channelColors.pushBack(t),(t=new De).R=0,t.G=0,t.B=0,t.A=1,this._channelColors.pushBack(t)}return t.prototype.getChannelFlagAsColor=function(t){return this._channelColors.at(t)},t.prototype.getMaskRenderTexture=function(){var t=0;if(this._maskTexture&&0!=this._maskTexture.texture&&(this._maskTexture.frameNo=this._currentFrameNo,t=this._maskTexture.texture),0==t){var e=this._clippingMaskBufferSize;this._colorBuffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this._colorBuffer),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),t=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._colorBuffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,r),this._maskTexture=new o(this._currentFrameNo,t)}return t},t.prototype.setGL=function(t){this.gl=t},t.prototype.calcClippedDrawTotalBounds=function(t,e){for(var i=Number.MAX_VALUE,r=Number.MAX_VALUE,n=Number.MIN_VALUE,o=Number.MIN_VALUE,s=e._clippedDrawableIndexList.length,a=0;a<s;a++){for(var u=e._clippedDrawableIndexList[a],l=t.getDrawableVertexCount(u),h=t.getDrawableVertices(u),p=Number.MAX_VALUE,c=Number.MAX_VALUE,g=Number.MIN_VALUE,d=Number.MIN_VALUE,_=l*Te.vertexStep,f=Te.vertexOffset;f<_;f+=Te.vertexStep){var m=h[f],y=h[f+1];m<p&&(p=m),m>g&&(g=m),y<c&&(c=y),y>d&&(d=y)}if(p!=Number.MAX_VALUE)if(p<i&&(i=p),c<r&&(r=c),g>n&&(n=g),d>o&&(o=d),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;var v=n-i,S=o-r;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=r,e._allClippedDrawRect.width=v,e._allClippedDrawRect.height=S}}},t.prototype.release=function(){for(var t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);this._clippingContextListForDraw=null,this._maskTexture&&(this.gl.deleteFramebuffer(this._maskTexture.texture),this._maskTexture=null);for(t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);this._channelColors=null,this.gl.deleteTexture(this._colorBuffer),this._colorBuffer=null},t.prototype.initialize=function(t,e,i,r){for(var n=0;n<e;n++)if(r[n]<=0)this._clippingContextListForDraw.pushBack(null);else{var o=this.findSameClip(i[n],r[n]);null==o&&(o=new s(this,i[n],r[n]),this._clippingContextListForMask.pushBack(o)),o.addClippedDrawable(n),this._clippingContextListForDraw.pushBack(o)}},t.prototype.setupClippingContext=function(t,e){this._currentFrameNo++;for(var n=0,o=0;o<this._clippingContextListForMask.getSize();o++){var s=this._clippingContextListForMask.at(o);this.calcClippedDrawTotalBounds(t,s),s._isUsing&&n++}if(n>0){this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._maskRenderTexture=this.getMaskRenderTexture();e.getMvpMatrix();e.preDraw(),this.setupLayoutBounds(n),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTexture),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(o=0;o<this._clippingContextListForMask.getSize();o++){var a=this._clippingContextListForMask.at(o),u=a._allClippedDrawRect,l=a._layoutBounds;this._tmpBoundsOnModel.setRect(u),this._tmpBoundsOnModel.expand(.05*u.width,.05*u.height);var h=l.width/this._tmpBoundsOnModel.width,p=l.height/this._tmpBoundsOnModel.height;this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(l.x,l.y),this._tmpMatrix.scaleRelative(h,p),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(l.x,l.y),this._tmpMatrix.scaleRelative(h,p),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray());for(var c=a._clippingIdCount,g=0;g<c;g++){var d=a._clippingIdList[g];t.getDrawableDynamicFlagVertexPositionsDidChange(d)&&(e.setIsCulling(0!=t.getDrawableCulling(d)),e.setClippingContextBufferForMask(a),e.drawMesh(t.getDrawableTextureIndices(d),t.getDrawableVertexIndexCount(d),t.getDrawableVertexCount(d),t.getDrawableVertexIndices(d),t.getDrawableVertices(d),t.getDrawableVertexUvs(d),t.getDrawableOpacity(d),ke.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,r),e.setClippingContextBufferForMask(null),this.gl.viewport(i[0],i[1],i[2],i[3])}},t.prototype.findSameClip=function(t,e){for(var i=0;i<this._clippingContextListForMask.getSize();i++){var r=this._clippingContextListForMask.at(i),n=r._clippingIdCount;if(n==e){for(var o=0,s=0;s<n;s++)for(var a=r._clippingIdList[s],u=0;u<n;u++)if(t[u]==a){o++;break}if(o==n)return r}}return null},t.prototype.setupLayoutBounds=function(t){var e=t/4,i=t%4;e=~~e,i=~~i;for(var r=0,n=0;n<4;n++){var o=e+(n<i?1:0);if(0==o);else if(1==o){var s=this._clippingContextListForMask.at(r++);s._layoutChannelNo=n,s._layoutBounds.x=0,s._layoutBounds.y=0,s._layoutBounds.width=1,s._layoutBounds.height=1}else if(2==o)for(var a=0;a<o;a++){u=~~(u=a%2),(h=this._clippingContextListForMask.at(r++))._layoutChannelNo=n,h._layoutBounds.x=.5*u,h._layoutBounds.y=0,h._layoutBounds.width=.5,h._layoutBounds.height=1}else if(o<=4)for(a=0;a<o;a++){u=~~(u=a%2),l=~~(l=a/2),(h=this._clippingContextListForMask.at(r++))._layoutChannelNo=n,h._layoutBounds.x=.5*u,h._layoutBounds.y=.5*l,h._layoutBounds.width=.5,h._layoutBounds.height=.5}else if(o<=9)for(a=0;a<o;a++){var u,l,h;u=~~(u=a%3),l=~~(l=a/3),(h=this._clippingContextListForMask.at(r++))._layoutChannelNo=n,h._layoutBounds.x=u/3,h._layoutBounds.y=l/3,h._layoutBounds.width=1/3,h._layoutBounds.height=1/3}else x("not supported mask count : {0}",o)}},t.prototype.getColorBuffer=function(){return this._colorBuffer},t.prototype.getClippingContextListForDraw=function(){return this._clippingContextListForDraw},t.prototype.setClippingMaskBufferSize=function(t){this._clippingMaskBufferSize=t},t.prototype.getClippingMaskBufferSize=function(){return this._clippingMaskBufferSize},t}();t.CubismClippingManager_WebGL=n;var o=function(t,e){this.frameNo=t,this.texture=e};t.CubismRenderTextureResource=o;var s=function(){function t(t,e,i){this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new Fe,this._layoutBounds=new Fe,this._clippedDrawableIndexList=new Array,this._matrixForMask=new Ee,this._matrixForDraw=new Ee}return t.prototype.release=function(){null!=this._layoutBounds&&(this._layoutBounds=null),null!=this._allClippedDrawRect&&(this._allClippedDrawRect=null),null!=this._clippedDrawableIndexList&&(this._clippedDrawableIndexList=null)},t.prototype.addClippedDrawable=function(t){this._clippedDrawableIndexList.push(t)},t.prototype.getClippingManager=function(){return this._owner},t.prototype.setGl=function(t){this._owner.setGL(t)},t}();t.CubismClippingContext=s;var a=function(){function i(){this._shaderSets=new Re}return i.getInstance=function(){return null==e?e=new i:e},i.deleteInstance=function(){e&&(e.release(),e=null)},i.prototype.release=function(){this.releaseShaderProgram()},i.prototype.setupShaderProgram=function(t,e,i,r,n,o,s,a,h,p,c,g,d){var _,f,m,y;if(c||x("NoPremultipliedAlpha is not allowed"),0==this._shaderSets.getSize()&&this.generateShaders(),null!=t.getClippingContextBufferForMask()){var v=this._shaderSets.at(u.ShaderNames_SetupMask);this.gl.useProgram(v.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(v.samplerTexture0Location,0),null==s.vertex&&(s.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(v.attributePositionLocation),this.gl.vertexAttribPointer(v.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==s.uv&&(s.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(v.attributeTexCoordLocation),this.gl.vertexAttribPointer(v.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);var S=t.getClippingContextBufferForMask()._layoutChannelNo,b=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(S);this.gl.uniform4f(v.uniformChannelFlagLocation,b.R,b.G,b.B,b.A),this.gl.uniformMatrix4fv(v.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());var C=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(v.uniformBaseColorLocation,2*C.x-1,2*C.y-1,2*C.getRight()-1,2*C.getBottom()-1),_=this.gl.ZERO,f=this.gl.ONE_MINUS_SRC_COLOR,m=this.gl.ZERO,y=this.gl.ONE_MINUS_SRC_ALPHA}else{var B=null!=t.getClippingContextBufferForDraw(),M=B?d?2:1:0;v=new l;switch(h){case ke.CubismBlendMode_Normal:default:v=this._shaderSets.at(u.ShaderNames_NormalPremultipliedAlpha+M),_=this.gl.ONE,f=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ONE,y=this.gl.ONE_MINUS_SRC_ALPHA;break;case ke.CubismBlendMode_Additive:v=this._shaderSets.at(u.ShaderNames_AddPremultipliedAlpha+M),_=this.gl.ONE,f=this.gl.ONE,m=this.gl.ZERO,y=this.gl.ONE;break;case ke.CubismBlendMode_Multiplicative:v=this._shaderSets.at(u.ShaderNames_MultPremultipliedAlpha+M),_=this.gl.DST_COLOR,f=this.gl.ONE_MINUS_SRC_ALPHA,m=this.gl.ZERO,y=this.gl.ONE}if(this.gl.useProgram(v.shaderProgram),null==s.vertex&&(s.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(v.attributePositionLocation),this.gl.vertexAttribPointer(v.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),null==s.uv&&(s.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,s.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(v.attributeTexCoordLocation),this.gl.vertexAttribPointer(v.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),B){this.gl.activeTexture(this.gl.TEXTURE1);var P=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer();this.gl.bindTexture(this.gl.TEXTURE_2D,P),this.gl.uniform1i(v.samplerTexture1Location,1),this.gl.uniformMatrix4fv(v.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());S=t.getClippingContextBufferForDraw()._layoutChannelNo,b=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(S);this.gl.uniform4f(v.uniformChannelFlagLocation,b.R,b.G,b.B,b.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(v.samplerTexture0Location,0),this.gl.uniformMatrix4fv(v.uniformMatrixLocation,!1,g.getArray()),this.gl.uniform4f(v.uniformBaseColorLocation,p.R,p.G,p.B,p.A)}null==s.index&&(s.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,s.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,n,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(_,f,m,y)},i.prototype.releaseShaderProgram=function(){for(var t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)},i.prototype.generateShaders=function(){for(var e=0;e<10;e++)this._shaderSets.pushBack(new l);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(t.vertexShaderSrcSetupMask,t.fragmentShaderSrcsetupMask),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(t.vertexShaderSrc,t.fragmentShaderSrcPremultipliedAlpha),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(t.vertexShaderSrcMasked,t.fragmentShaderSrcMaskPremultipliedAlpha),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(t.vertexShaderSrcMasked,t.fragmentShaderSrcMaskInvertedPremultipliedAlpha),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor")},i.prototype.loadShaderProgram=function(t,e){var i=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!r)return x("Vertex shader compile error!"),0;var n=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return n?(this.gl.attachShader(i,r),this.gl.attachShader(i,n),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(n),i):(x("Failed to link program: {0}",i),this.gl.deleteShader(r),r=0,this.gl.deleteShader(n),n=0,i&&(this.gl.deleteProgram(i),i=0),0)):(x("Vertex shader compile error!"),0)},i.prototype.compileShaderSource=function(t,e){var i=e,r=this.gl.createShader(t);if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!r){var n=this.gl.getShaderInfoLog(r);x("Shader compile log: {0} ",n)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)},i.prototype.setGl=function(t){this.gl=t},i}();t.CubismShader_WebGL=a;var u,l=function(){};t.CubismShaderSet=l,function(t){t[t.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",t[t.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",t[t.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",t[t.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",t[t.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",t[t.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",t[t.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",t[t.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",t[t.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",t[t.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted"}(u=t.ShaderNames||(t.ShaderNames={})),t.vertexShaderSrcSetupMask="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",t.fragmentShaderSrcsetupMask="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",t.vertexShaderSrc="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",t.vertexShaderSrcMasked="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",t.fragmentShaderSrcPremultipliedAlpha="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;void main(){   gl_FragColor = texture2D(s_texture0 , v_texCoord) * u_baseColor;}",t.fragmentShaderSrcMaskPremultipliedAlpha="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;void main(){   vec4 col_formask = texture2D(s_texture0 , v_texCoord) * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",t.fragmentShaderSrcMaskInvertedPremultipliedAlpha="precision mediump float;varying vec2 v_texCoord;varying vec4 v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4 u_channelFlag;uniform vec4 u_baseColor;void main(){vec4 col_formask = texture2D(s_texture0, v_texCoord) * u_baseColor;vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;col_formask = col_formask * (1.0 - maskVal);gl_FragColor = col_formask;}";var h=function(t){function e(){var e=t.call(this)||this;return e._clippingContextBufferForMask=null,e._clippingContextBufferForDraw=null,e._clippingManager=new n,e.firstDraw=!0,e._textures=new Le,e._sortedDrawableIndexList=new Re,e._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},e._textures.prepareCapacity(32,!0),e}return Ve(e,t),e.prototype.initialize=function(e){e.isUsingMasking()&&(this._clippingManager=new n,this._clippingManager.initialize(e,e.getDrawableCount(),e.getDrawableMasks(),e.getDrawableMaskCounts())),this._sortedDrawableIndexList.resize(e.getDrawableCount(),0),t.prototype.initialize.call(this,e)},e.prototype.bindTexture=function(t,e){this._textures.setValue(t,e)},e.prototype.getBindedTextures=function(){return this._textures},e.prototype.setClippingMaskBufferSize=function(t){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new n,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts())},e.prototype.getClippingMaskBufferSize=function(){return this._clippingManager.getClippingMaskBufferSize()},e.prototype.release=function(){this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null},e.prototype.doDrawModel=function(){null!=this._clippingManager&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();for(var t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders(),i=0;i<t;++i){var r=e[i];this._sortedDrawableIndexList.set(r,i)}for(i=0;i<t;++i){var n=this._sortedDrawableIndexList.at(i);this.getModel().getDrawableDynamicFlagIsVisible(n)&&(this.setClippingContextBufferForDraw(null!=this._clippingManager?this._clippingManager.getClippingContextListForDraw().at(n):null),this.setIsCulling(this.getModel().getDrawableCulling(n)),this.drawMesh(this.getModel().getDrawableTextureIndices(n),this.getModel().getDrawableVertexIndexCount(n),this.getModel().getDrawableVertexCount(n),this.getModel().getDrawableVertexIndices(n),this.getModel().getDrawableVertices(n),this.getModel().getDrawableVertexUvs(n),this.getModel().getDrawableOpacity(n),this.getModel().getDrawableBlendMode(n),this.getModel().getDrawableInvertedMaskBit(n)))}},e.prototype.drawMesh=function(t,e,i,r,n,o,s,u,l){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);var h,p=this.getModelColor();null==this.getClippingContextBufferForMask()&&(p.A*=s,this.isPremultipliedAlpha()&&(p.R*=p.A,p.G*=p.A,p.B*=p.A)),h=null!=this._textures.getValue(t)?this._textures.getValue(t):null,a.getInstance().setupShaderProgram(this,h,i,n,r,o,this._bufferData,s,u,p,this.isPremultipliedAlpha(),this.getMvpMatrix(),l),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)},e.doStaticRelease=function(){a.deleteInstance()},e.prototype.setRenderState=function(t,e){r=t,i=e},e.prototype.preDraw=function(){this.firstDraw&&(this.firstDraw=!1,this._anisortopy=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)},e.prototype.setClippingContextBufferForMask=function(t){this._clippingContextBufferForMask=t},e.prototype.getClippingContextBufferForMask=function(){return this._clippingContextBufferForMask},e.prototype.setClippingContextBufferForDraw=function(t){this._clippingContextBufferForDraw=t},e.prototype.getClippingContextBufferForDraw=function(){return this._clippingContextBufferForDraw},e.prototype.startUp=function(t){this.gl=t,this._clippingManager.setGL(t),a.getInstance().setGl(t)},e}(Ae);t.CubismRenderer_WebGL=h,Ae.staticRelease=function(){h.doStaticRelease()}}(Ie||(Ie={}));var Ne,Oe,Ue=Ie.CubismRenderer_WebGL,ze=Me.CubismEyeBlink,je=de.CubismBreath,Xe=k.Constant,Ye=ge.CubismPhysics,Ge=ee.CubismModelUserData,qe=Wt.CubismPose,He=jt.CubismExpressionMotion,We=It.CubismMotion,Je=St.CubismMoc,Ke=ct.CubismModelMatrix,Ze=ht.CubismTargetPoint,Qe=at.CubismMotionManager;!function(t){var e=function(){function t(){this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._debugMode=!1,this._renderer=null,this._motionManager=new Qe,this._motionManager.setEventCallback(t.cubismDefaultMotionEventCallback,this),this._expressionManager=new Qe,this._dragManager=new Ze}return t.prototype.isInitialized=function(){return this._initialized},t.prototype.setInitialized=function(t){this._initialized=t},t.prototype.isUpdating=function(){return this._updating},t.prototype.setUpdating=function(t){this._updating=t},t.prototype.setDragging=function(t,e){this._dragManager.set(t,e)},t.prototype.setAcceleration=function(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i},t.prototype.getModelMatrix=function(){return this._modelMatrix},t.prototype.setOpacity=function(t){this._opacity=t},t.prototype.getOpacity=function(){return this._opacity},t.prototype.loadModel=function(t){this._moc=Je.create(t),this._model=this._moc.createModel(),this._model.saveParameters(),null!=this._moc&&null!=this._model?this._modelMatrix=new Ke(this._model.getCanvasWidth(),this._model.getCanvasHeight()):x("Failed to CreateModel().")},t.prototype.loadMotion=function(t,e,i){return We.create(t,e)},t.prototype.loadExpression=function(t,e,i){return He.create(t,e)},t.prototype.loadPose=function(t,e){this._pose=qe.create(t,e)},t.prototype.loadUserData=function(t,e){this._modelUserData=Ge.create(t,e)},t.prototype.loadPhysics=function(t,e){this._physics=Ye.create(t,e)},t.prototype.isHit=function(t,e,i){var r=this._model.getDrawableIndex(t);if(r<0)return{hit:!1,area:0};for(var n=this._model.getDrawableVertexCount(r),o=this._model.getDrawableVertices(r),s=o[0],a=o[0],u=o[1],l=o[1],h=1;h<n;++h){var p=o[Xe.vertexOffset+h*Xe.vertexStep],c=o[Xe.vertexOffset+h*Xe.vertexStep+1];p<s&&(s=p),p>a&&(a=p),c<u&&(u=c),c>l&&(l=c)}var g=this._modelMatrix.invertTransformX(e),d=this._modelMatrix.invertTransformY(i);return{hit:s<=g&&g<=a&&u<=d&&d<=l,area:Math.abs(s-a)*Math.abs(l-u)}},t.prototype.getModel=function(){return this._model},t.prototype.getRenderer=function(){return this._renderer},t.prototype.createRenderer=function(){this._renderer&&this.deleteRenderer(),this._renderer=new Ue,this._renderer.initialize(this._model)},t.prototype.deleteRenderer=function(){null!=this._renderer&&(this._renderer.release(),this._renderer=null)},t.prototype.motionEventFired=function(t){v("{0}",t.s)},t.cubismDefaultMotionEventCallback=function(t,e,i){null!=i&&i.motionEventFired(e)},t.prototype.release=function(){null!=this._motionManager&&(this._motionManager.release(),this._motionManager=null),null!=this._expressionManager&&(this._expressionManager.release(),this._expressionManager=null),null!=this._moc&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,qe.delete(this._pose),ze.delete(this._eyeBlink),je.delete(this._breath),this._dragManager=null,Ye.delete(this._physics),Ge.delete(this._modelUserData),this.deleteRenderer()},t}();t.CubismUserModel=e}(Ne||(Ne={})),function(t){var e=function(){};t.ICubismModelSetting=e}(Oe||(Oe={}));var $e,ti,ei,ii=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ri=_.csmVector,ni=k.CubismFramework,oi=C.CubismJson,si=Oe.ICubismModelSetting;!function(t){var e,i="Name";!function(t){t[t.FrequestNode_Groups=0]="FrequestNode_Groups",t[t.FrequestNode_Moc=1]="FrequestNode_Moc",t[t.FrequestNode_Motions=2]="FrequestNode_Motions",t[t.FrequestNode_Expressions=3]="FrequestNode_Expressions",t[t.FrequestNode_Textures=4]="FrequestNode_Textures",t[t.FrequestNode_Physics=5]="FrequestNode_Physics",t[t.FrequestNode_Pose=6]="FrequestNode_Pose",t[t.FrequestNode_HitAreas=7]="FrequestNode_HitAreas"}(e||(e={}));var r=function(t){function r(e,i){var r=t.call(this)||this;return r._json=oi.create(e,i),r._json&&(r._jsonValue=new ri,r._jsonValue.pushBack(r._json.getRoot().getValueByString("Groups")),r._jsonValue.pushBack(r._json.getRoot().getValueByString("FileReferences").getValueByString("Moc")),r._jsonValue.pushBack(r._json.getRoot().getValueByString("FileReferences").getValueByString("Motions")),r._jsonValue.pushBack(r._json.getRoot().getValueByString("FileReferences").getValueByString("Expressions")),r._jsonValue.pushBack(r._json.getRoot().getValueByString("FileReferences").getValueByString("Textures")),r._jsonValue.pushBack(r._json.getRoot().getValueByString("FileReferences").getValueByString("Physics")),r._jsonValue.pushBack(r._json.getRoot().getValueByString("FileReferences").getValueByString("Pose")),r._jsonValue.pushBack(r._json.getRoot().getValueByString("HitAreas"))),r}return ii(r,t),r.prototype.release=function(){oi.delete(this._json),this._jsonValue=null},r.prototype.GetJson=function(){return this._json},r.prototype.getModelFileName=function(){return this.isExistModelFile()?this._jsonValue.at(e.FrequestNode_Moc).getRawString():""},r.prototype.getTextureCount=function(){return this.isExistTextureFiles()?this._jsonValue.at(e.FrequestNode_Textures).getSize():0},r.prototype.getTextureDirectory=function(){return this._jsonValue.at(e.FrequestNode_Textures).getRawString()},r.prototype.getTextureFileName=function(t){return this._jsonValue.at(e.FrequestNode_Textures).getValueByIndex(t).getRawString()},r.prototype.getHitAreasCount=function(){return this.isExistHitAreas()?this._jsonValue.at(e.FrequestNode_HitAreas).getSize():0},r.prototype.getHitAreaId=function(t){return ni.getIdManager().getId(this._jsonValue.at(e.FrequestNode_HitAreas).getValueByIndex(t).getValueByString("Id").getRawString())},r.prototype.getHitAreaName=function(t){return this._jsonValue.at(e.FrequestNode_HitAreas).getValueByIndex(t).getValueByString(i).getRawString()},r.prototype.getPhysicsFileName=function(){return this.isExistPhysicsFile()?this._jsonValue.at(e.FrequestNode_Physics).getRawString():""},r.prototype.getPoseFileName=function(){return this.isExistPoseFile()?this._jsonValue.at(e.FrequestNode_Pose).getRawString():""},r.prototype.getExpressionCount=function(){return this.isExistExpressionFile()?this._jsonValue.at(e.FrequestNode_Expressions).getSize():0},r.prototype.getExpressionName=function(t){return this._jsonValue.at(e.FrequestNode_Expressions).getValueByIndex(t).getValueByString(i).getRawString()},r.prototype.getExpressionFileName=function(t){return this._jsonValue.at(e.FrequestNode_Expressions).getValueByIndex(t).getValueByString("File").getRawString()},r.prototype.getMotionGroupCount=function(){return this.isExistMotionGroups()?this._jsonValue.at(e.FrequestNode_Motions).getKeys().getSize():0},r.prototype.getMotionGroupName=function(t){return this.isExistMotionGroups()?this._jsonValue.at(e.FrequestNode_Motions).getKeys().at(t):null},r.prototype.getMotionCount=function(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(e.FrequestNode_Motions).getValueByString(t).getSize():0},r.prototype.getMotionFileName=function(t,i){return this.isExistMotionGroupName(t)?this._jsonValue.at(e.FrequestNode_Motions).getValueByString(t).getValueByIndex(i).getValueByString("File").getRawString():""},r.prototype.getMotionSoundFileName=function(t,i){return this.isExistMotionSoundFile(t,i)?this._jsonValue.at(e.FrequestNode_Motions).getValueByString(t).getValueByIndex(i).getValueByString("Sound").getRawString():""},r.prototype.getMotionFadeInTimeValue=function(t,i){return this.isExistMotionFadeIn(t,i)?this._jsonValue.at(e.FrequestNode_Motions).getValueByString(t).getValueByIndex(i).getValueByString("FadeInTime").toFloat():-1},r.prototype.getMotionFadeOutTimeValue=function(t,i){return this.isExistMotionFadeOut(t,i)?this._jsonValue.at(e.FrequestNode_Motions).getValueByString(t).getValueByIndex(i).getValueByString("FadeOutTime").toFloat():-1},r.prototype.getUserDataFile=function(){return this.isExistUserDataFile()?this._json.getRoot().getValueByString("FileReferences").getValueByString("UserData").getRawString():""},r.prototype.getLayoutMap=function(t){var e=this._json.getRoot().getValueByString("Layout").getMap();if(null==e)return!1;for(var i=!1,r=e.begin();r.notEqual(e.end());r.preIncrement())t.setValue(r.ptr().first,r.ptr().second.toFloat()),i=!0;return i},r.prototype.getEyeBlinkParameterCount=function(){if(!this.isExistEyeBlinkParameters())return 0;for(var t=0,r=0;r<this._jsonValue.at(e.FrequestNode_Groups).getSize();r++){var n=this._jsonValue.at(e.FrequestNode_Groups).getValueByIndex(r);if(!n.isNull()&&!n.isError()&&"EyeBlink"==n.getValueByString(i).getRawString()){t=n.getValueByString("Ids").getVector().getSize();break}}return t},r.prototype.getEyeBlinkParameterId=function(t){if(!this.isExistEyeBlinkParameters())return null;for(var r=0;r<this._jsonValue.at(e.FrequestNode_Groups).getSize();r++){var n=this._jsonValue.at(e.FrequestNode_Groups).getValueByIndex(r);if(!n.isNull()&&!n.isError()&&"EyeBlink"==n.getValueByString(i).getRawString())return ni.getIdManager().getId(n.getValueByString("Ids").getValueByIndex(t).getRawString())}return null},r.prototype.getLipSyncParameterCount=function(){if(!this.isExistLipSyncParameters())return 0;for(var t=0,r=0;r<this._jsonValue.at(e.FrequestNode_Groups).getSize();r++){var n=this._jsonValue.at(e.FrequestNode_Groups).getValueByIndex(r);if(!n.isNull()&&!n.isError()&&"LipSync"==n.getValueByString(i).getRawString()){t=n.getValueByString("Ids").getVector().getSize();break}}return t},r.prototype.getLipSyncParameterId=function(t){if(!this.isExistLipSyncParameters())return null;for(var r=0;r<this._jsonValue.at(e.FrequestNode_Groups).getSize();r++){var n=this._jsonValue.at(e.FrequestNode_Groups).getValueByIndex(r);if(!n.isNull()&&!n.isError()&&"LipSync"==n.getValueByString(i).getRawString())return ni.getIdManager().getId(n.getValueByString("Ids").getValueByIndex(t).getRawString())}return null},r.prototype.isExistModelFile=function(){var t=this._jsonValue.at(e.FrequestNode_Moc);return!t.isNull()&&!t.isError()},r.prototype.isExistTextureFiles=function(){var t=this._jsonValue.at(e.FrequestNode_Textures);return!t.isNull()&&!t.isError()},r.prototype.isExistHitAreas=function(){var t=this._jsonValue.at(e.FrequestNode_HitAreas);return!t.isNull()&&!t.isError()},r.prototype.isExistPhysicsFile=function(){var t=this._jsonValue.at(e.FrequestNode_Physics);return!t.isNull()&&!t.isError()},r.prototype.isExistPoseFile=function(){var t=this._jsonValue.at(e.FrequestNode_Pose);return!t.isNull()&&!t.isError()},r.prototype.isExistExpressionFile=function(){var t=this._jsonValue.at(e.FrequestNode_Expressions);return!t.isNull()&&!t.isError()},r.prototype.isExistMotionGroups=function(){var t=this._jsonValue.at(e.FrequestNode_Motions);return!t.isNull()&&!t.isError()},r.prototype.isExistMotionGroupName=function(t){var i=this._jsonValue.at(e.FrequestNode_Motions).getValueByString(t);return!i.isNull()&&!i.isError()},r.prototype.isExistMotionSoundFile=function(t,i){var r=this._jsonValue.at(e.FrequestNode_Motions).getValueByString(t).getValueByIndex(i).getValueByString("Sound");return!r.isNull()&&!r.isError()},r.prototype.isExistMotionFadeIn=function(t,i){var r=this._jsonValue.at(e.FrequestNode_Motions).getValueByString(t).getValueByIndex(i).getValueByString("FadeInTime");return!r.isNull()&&!r.isError()},r.prototype.isExistMotionFadeOut=function(t,i){var r=this._jsonValue.at(e.FrequestNode_Motions).getValueByString(t).getValueByIndex(i).getValueByString("FadeOutTime");return!r.isNull()&&!r.isError()},r.prototype.isExistUserDataFile=function(){var t=this._json.getRoot().getValueByString("FileReferences").getValueByString("UserData");return!t.isNull()&&!t.isError()},r.prototype.isExistEyeBlinkParameters=function(){if(this._jsonValue.at(e.FrequestNode_Groups).isNull()||this._jsonValue.at(e.FrequestNode_Groups).isError())return!1;for(var t=0;t<this._jsonValue.at(e.FrequestNode_Groups).getSize();++t)if("EyeBlink"==this._jsonValue.at(e.FrequestNode_Groups).getValueByIndex(t).getValueByString(i).getRawString())return!0;return!1},r.prototype.isExistLipSyncParameters=function(){if(this._jsonValue.at(e.FrequestNode_Groups).isNull()||this._jsonValue.at(e.FrequestNode_Groups).isError())return!1;for(var t=0;t<this._jsonValue.at(e.FrequestNode_Groups).getSize();++t)if("LipSync"==this._jsonValue.at(e.FrequestNode_Groups).getValueByIndex(t).getValueByString(i).getRawString())return!0;return!1},r}(si);t.CubismModelSettingJson=r}($e||($e={})),function(t){t.HitAreaPrefix="HitArea",t.HitAreaHead="Head",t.HitAreaBody="Body",t.PartsIdCore="Parts01Core",t.PartsArmPrefix="Parts01Arm_",t.PartsArmLPrefix="Parts01ArmL_",t.PartsArmRPrefix="Parts01ArmR_",t.ParamAngleX="ParamAngleX",t.ParamAngleY="ParamAngleY",t.ParamAngleZ="ParamAngleZ",t.ParamEyeLOpen="ParamEyeLOpen",t.ParamEyeLSmile="ParamEyeLSmile",t.ParamEyeROpen="ParamEyeROpen",t.ParamEyeRSmile="ParamEyeRSmile",t.ParamEyeBallX="ParamEyeBallX",t.ParamEyeBallY="ParamEyeBallY",t.ParamEyeBallForm="ParamEyeBallForm",t.ParamBrowLY="ParamBrowLY",t.ParamBrowRY="ParamBrowRY",t.ParamBrowLX="ParamBrowLX",t.ParamBrowRX="ParamBrowRX",t.ParamBrowLAngle="ParamBrowLAngle",t.ParamBrowRAngle="ParamBrowRAngle",t.ParamBrowLForm="ParamBrowLForm",t.ParamBrowRForm="ParamBrowRForm",t.ParamMouthForm="ParamMouthForm",t.ParamMouthOpenY="ParamMouthOpenY",t.ParamCheek="ParamCheek",t.ParamBodyAngleX="ParamBodyAngleX",t.ParamBodyAngleY="ParamBodyAngleY",t.ParamBodyAngleZ="ParamBodyAngleZ",t.ParamBreath="ParamBreath",t.ParamArmLA="ParamArmLA",t.ParamArmRA="ParamArmRA",t.ParamArmLB="ParamArmLB",t.ParamArmRB="ParamArmRB",t.ParamHandL="ParamHandL",t.ParamHandR="ParamHandR",t.ParamHairFront="ParamHairFront",t.ParamHairSide="ParamHairSide",t.ParamHairBack="ParamHairBack",t.ParamHairFluffy="ParamHairFluffy",t.ParamShoulderY="ParamShoulderY",t.ParamBustX="ParamBustX",t.ParamBustY="ParamBustY",t.ParamBaseX="ParamBaseX",t.ParamBaseY="ParamBaseY",t.ParamNONE="NONE:"}(ti||(ti={})),function(t){var e=function(){function t(){}return t.getFormatedString=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=t;return r.replace(/\{(\d+)\}/g,(function(t,i){return e[i]}))},t.isStartWith=function(t,e){for(var i=0,r=0;"\0"!=e[r];)if("\0"==t[i]||t[i++]!=e[r++])return!1;return!1},t.stringToFloat=function(t,e,i,r){var n=i,o=!1,s=!1,a=0,u=parseInt(t[n]);for(u<0&&(o=!0,n++);n<e;n++){var l=t[n];if(!(0<=parseInt(l)&&parseInt(l)<=9)){if("."==l){s=!0,n++;break}break}a=10*a+(parseInt(l)-0)}if(s)for(var h=.1;n<e&&(0<=(u=255&parseFloat(t[n]))&&u<=9)&&(a+=h*(u-0),h*=.1,u);n++);return n==i?(r[0]=-1,0):(o&&(a=-a),r[0]=n,a)},t}();t.CubismString=e}(ei||(ei={}));var ai="URLSearchParams"in self,ui="Symbol"in self&&"iterator"in Symbol,li="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),hi="FormData"in self,pi="ArrayBuffer"in self;if(pi)var ci=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],gi=ArrayBuffer.isView||function(t){return t&&ci.indexOf(Object.prototype.toString.call(t))>-1};function di(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function _i(t){return"string"!=typeof t&&(t=String(t)),t}function fi(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return ui&&(e[Symbol.iterator]=function(){return e}),e}function mi(t){this.map={},t instanceof mi?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function yi(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function vi(t){return new Promise((function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}}))}function Si(t){var e=new FileReader,i=vi(e);return e.readAsArrayBuffer(t),i}function xi(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function bi(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:li&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:hi&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:ai&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():pi&&li&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=xi(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):pi&&(ArrayBuffer.prototype.isPrototypeOf(t)||gi(t))?this._bodyArrayBuffer=xi(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ai&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},li&&(this.blob=function(){var t=yi(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?yi(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(Si)}),this.text=function(){var t,e,i,r=yi(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,i=vi(e),e.readAsText(t),i;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),i=new Array(e.length),r=0;r<e.length;r++)i[r]=String.fromCharCode(e[r]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},hi&&(this.formData=function(){return this.text().then(Mi)}),this.json=function(){return this.text().then(JSON.parse)},this}mi.prototype.append=function(t,e){t=di(t),e=_i(e);var i=this.map[t];this.map[t]=i?i+", "+e:e},mi.prototype.delete=function(t){delete this.map[di(t)]},mi.prototype.get=function(t){return t=di(t),this.has(t)?this.map[t]:null},mi.prototype.has=function(t){return this.map.hasOwnProperty(di(t))},mi.prototype.set=function(t,e){this.map[di(t)]=_i(e)},mi.prototype.forEach=function(t,e){for(var i in this.map)this.map.hasOwnProperty(i)&&t.call(e,this.map[i],i,this)},mi.prototype.keys=function(){var t=[];return this.forEach((function(e,i){t.push(i)})),fi(t)},mi.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),fi(t)},mi.prototype.entries=function(){var t=[];return this.forEach((function(e,i){t.push([i,e])})),fi(t)},ui&&(mi.prototype[Symbol.iterator]=mi.prototype.entries);var Ci=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Bi(t,e){var i,r,n=(e=e||{}).body;if(t instanceof Bi){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new mi(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new mi(e.headers)),this.method=(i=e.method||this.method||"GET",r=i.toUpperCase(),Ci.indexOf(r)>-1?r:i),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function Mi(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var i=t.split("="),r=i.shift().replace(/\+/g," "),n=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(n))}})),e}function Pi(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new mi(e.headers),this.url=e.url||"",this._initBody(t)}Bi.prototype.clone=function(){return new Bi(this,{body:this._bodyInit})},bi.call(Bi.prototype),bi.call(Pi.prototype),Pi.prototype.clone=function(){return new Pi(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new mi(this.headers),url:this.url})},Pi.error=function(){var t=new Pi(null,{status:0,statusText:""});return t.type="error",t};var wi=[301,302,303,307,308];Pi.redirect=function(t,e){if(-1===wi.indexOf(e))throw new RangeError("Invalid status code");return new Pi(null,{status:e,headers:{location:t}})};var Ii=self.DOMException;try{new Ii}catch(t){(Ii=function(t,e){this.message=t,this.name=e;var i=Error(t);this.stack=i.stack}).prototype=Object.create(Error.prototype),Ii.prototype.constructor=Ii}function Vi(t,e){return new Promise((function(i,r){var n=new Bi(t,e);if(n.signal&&n.signal.aborted)return r(new Ii("Aborted","AbortError"));var o=new XMLHttpRequest;function s(){o.abort()}o.onload=function(){var t,e,r={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",e=new mi,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var i=t.split(":"),r=i.shift().trim();if(r){var n=i.join(":").trim();e.append(r,n)}})),e)};r.url="responseURL"in o?o.responseURL:r.headers.get("X-Request-URL");var n="response"in o?o.response:o.responseText;i(new Pi(n,r))},o.onerror=function(){r(new TypeError("Network request failed"))},o.ontimeout=function(){r(new TypeError("Network request failed"))},o.onabort=function(){r(new Ii("Aborted","AbortError"))},o.open(n.method,n.url,!0),"include"===n.credentials?o.withCredentials=!0:"omit"===n.credentials&&(o.withCredentials=!1),"responseType"in o&&li&&(o.responseType="blob"),n.headers.forEach((function(t,e){o.setRequestHeader(e,t)})),n.signal&&(n.signal.addEventListener("abort",s),o.onreadystatechange=function(){4===o.readyState&&n.signal.removeEventListener("abort",s)}),o.send(void 0===n._bodyInit?null:n._bodyInit)}))}Vi.polyfill=!0,self.fetch||(self.fetch=Vi,self.Headers=mi,self.Request=Bi,self.Response=Pi);var Ti,Ei=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Fi=function(t,e,i,r){return new(i||(i=Promise))((function(n,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},Li=function(t,e){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},Ri=nt.InvalidMotionQueueEntryHandleValue,Ai=ei.CubismString,ki=d.csmMap,Di=_.csmVector,Ni=de.CubismBreath,Oi=de.BreathParameterData,Ui=Me.CubismEyeBlink,zi=$.ACubismMotion,ji=k.CubismFramework,Xi=Ne.CubismUserModel,Yi=$e.CubismModelSettingJson,Gi=ti,qi=E.CubismMatrix44;!function(t){t[t.LoadAssets=0]="LoadAssets",t[t.LoadModel=1]="LoadModel",t[t.WaitLoadModel=2]="WaitLoadModel",t[t.LoadExpression=3]="LoadExpression",t[t.WaitLoadExpression=4]="WaitLoadExpression",t[t.LoadPhysics=5]="LoadPhysics",t[t.WaitLoadPhysics=6]="WaitLoadPhysics",t[t.LoadPose=7]="LoadPose",t[t.WaitLoadPose=8]="WaitLoadPose",t[t.SetupEyeBlink=9]="SetupEyeBlink",t[t.SetupBreath=10]="SetupBreath",t[t.LoadUserData=11]="LoadUserData",t[t.WaitLoadUserData=12]="WaitLoadUserData",t[t.SetupEyeBlinkIds=13]="SetupEyeBlinkIds",t[t.SetupLipSyncIds=14]="SetupLipSyncIds",t[t.SetupLayout=15]="SetupLayout",t[t.LoadMotion=16]="LoadMotion",t[t.WaitLoadMotion=17]="WaitLoadMotion",t[t.CompleteInitialize=18]="CompleteInitialize",t[t.CompleteSetupModel=19]="CompleteSetupModel",t[t.LoadTexture=20]="LoadTexture",t[t.WaitLoadTexture=21]="WaitLoadTexture",t[t.CompleteSetup=22]="CompleteSetup"}(Ti||(Ti={}));var Hi,Wi=function(t){function e(e,i,r){var n=t.call(this)||this;return n._setting=e,n._textureManager=i,n._webgl=r,n._viewMatrix=new qi,n.s_currentFrame=0,n.s_lastFrame=0,n.s_deltaTime=0,n._modelSetting=null,n._userTimeSeconds=0,n._eyeBlinkIds=new Di,n._lipSyncIds=new Di,n._motions=new ki,n._expressions=new ki,n._hitArea=new Di,n._userArea=new Di,n._idParamAngleX=ji.getIdManager().getId(Gi.ParamAngleX),n._idParamAngleY=ji.getIdManager().getId(Gi.ParamAngleY),n._idParamAngleZ=ji.getIdManager().getId(Gi.ParamAngleZ),n._idParamEyeBallX=ji.getIdManager().getId(Gi.ParamEyeBallX),n._idParamEyeBallY=ji.getIdManager().getId(Gi.ParamEyeBallY),n._idParamBodyAngleX=ji.getIdManager().getId(Gi.ParamBodyAngleX),n._state=Ti.LoadAssets,n._expressionCount=0,n._textureCount=0,n._motionCount=0,n._allMotionCount=0,n.loadAssets(n._setting.modelBuffer),n}return Ei(e,t),e.prototype.loadAssets=function(t){return Fi(this,void 0,void 0,(function(){var e,i;return Li(this,(function(r){return e=t.byteLength,i=new Yi(t,e),this._state=Ti.LoadModel,this.setupModel(i),[2]}))}))},e.prototype.setupModel=function(t){return Fi(this,void 0,void 0,(function(){var e,i,r,n,o,s,u,l,h,p,c,g,d,_,f,m,y,v,S,x,b,C,B,M;return Li(this,(function(P){switch(P.label){case 0:return this._updating=!0,this._initialized=!1,this._modelSetting=t,""==this._modelSetting.getModelFileName()?[3,12]:(this._state=Ti.WaitLoadModel,e=this._modelSetting.getModelFileName(),e=this._setting.baseUrl+e,[4,a.getArraybuffer(e)]);case 1:if(i=P.sent(),this.loadModel(i),this._state=Ti.LoadExpression,!(this._modelSetting.getExpressionCount()>0))return[3,5];this._state=Ti.WaitLoadExpression,r=this._modelSetting.getExpressionCount(),M=0,P.label=2;case 2:return M<r?(n=this._modelSetting.getExpressionName(M),o=this._modelSetting.getExpressionFileName(M),o=this._setting.baseUrl+o,[4,a.getArraybuffer(o)]):[3,5];case 3:s=P.sent(),u=s.byteLength,l=this.loadExpression(s,u,n),null!=this._expressions.getValue(n)&&(zi.delete(this._expressions.getValue(n)),this._expressions.setValue(n,null)),this._expressions.setValue(n,l),this._expressionCount++,P.label=4;case 4:return M++,[3,2];case 5:return this._state=Ti.LoadPhysics,""==this._modelSetting.getPhysicsFileName()?[3,7]:(this._state=Ti.WaitLoadPhysics,h=this._modelSetting.getPhysicsFileName(),h=this._setting.baseUrl+h,[4,a.getArraybuffer(h)]);case 6:p=P.sent(),c=p.byteLength,this.loadPhysics(p,c),P.label=7;case 7:return this._state=Ti.LoadPose,""==this._modelSetting.getPoseFileName()?[3,9]:(this._state=Ti.WaitLoadPose,g=this._modelSetting.getPoseFileName(),g=this._setting.baseUrl+g,[4,a.getArraybuffer(g)]);case 8:d=P.sent(),_=d.byteLength,this.loadPose(d,_),P.label=9;case 9:return this._state=Ti.SetupEyeBlink,this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=Ui.create(this._modelSetting)),this._state=Ti.SetupBreath,this._breath=Ni.create(),(f=new Di).pushBack(new Oi(this._idParamAngleX,0,15,6.5345,.5)),f.pushBack(new Oi(this._idParamAngleY,0,8,3.5345,.5)),f.pushBack(new Oi(this._idParamAngleZ,0,10,5.5345,.5)),f.pushBack(new Oi(this._idParamBodyAngleX,0,4,15.5345,.5)),f.pushBack(new Oi(ji.getIdManager().getId(Gi.ParamBreath),0,.5,3.2345,.5)),this._breath.setParameters(f),this._state=Ti.LoadUserData,""==this._modelSetting.getUserDataFile()?[3,11]:(this._state=Ti.WaitLoadUserData,m=this._modelSetting.getUserDataFile(),m=this._setting.baseUrl+m,[4,a.getArraybuffer(m)]);case 10:y=P.sent(),v=y.byteLength,this.loadUserData(y,v),P.label=11;case 11:for(this._state=Ti.SetupEyeBlinkIds,S=this._modelSetting.getEyeBlinkParameterCount(),M=0;M<S;++M)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(M));for(this._state=Ti.SetupLipSyncIds,x=this._modelSetting.getLipSyncParameterCount(),M=0;M<x;++M)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(M));for(this._state=Ti.SetupLayout,b=new ki,this._modelSetting.getLayoutMap(b),this._modelMatrix.setupFromLayout(b),this._state=Ti.LoadMotion,this._state=Ti.WaitLoadMotion,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0,C=[],B=this._modelSetting.getMotionGroupCount(),M=0;M<B;M++)C[M]=this._modelSetting.getMotionGroupName(M),this._allMotionCount+=this._modelSetting.getMotionCount(C[M]);for(M=0;M<B;M++)this.preLoadMotionGroup(C[M]);return 0==B&&(this._state=Ti.LoadTexture,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(this._webgl.gl)),[3,12];case 12:return[2]}}))}))},e.prototype.setupTextures=function(){return Fi(this,void 0,void 0,(function(){var t,e,i,r,n;return Li(this,(function(o){switch(o.label){case 0:if(t=!0,this._state!=Ti.LoadTexture)return[3,5];this._state=Ti.WaitLoadTexture,e=this._modelSetting.getTextureCount(),i=0,o.label=1;case 1:return i<e?""==this._modelSetting.getTextureFileName(i)?(console.log("getTextureFileName null"),[3,3]):(r=this._modelSetting.getTextureFileName(i),r=this._setting.baseUrl+r,[4,this._textureManager.createTextureFromPngFile(r,t)]):[3,4];case 2:n=o.sent(),this.getRenderer().bindTexture(i,n.id),this._textureCount++,this.getRenderer().setIsPremultipliedAlpha(t),o.label=3;case 3:return i++,[3,1];case 4:this._state=Ti.CompleteSetup,o.label=5;case 5:return[2]}}))}))},e.prototype.reloadRenderer=function(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()},e.prototype.update=function(){if(this._state==Ti.CompleteSetup){var t=this.s_deltaTime;this._userTimeSeconds+=t,this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();var e=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion(this._setting.idle,this._setting.Priority.Idle):e=this._motionManager.updateMotion(this._model,t),this._model.saveParameters(),e||null!=this._eyeBlink&&this._eyeBlink.updateParameters(this._model,t),null!=this._expressionManager&&this._expressionManager.updateMotion(this._model,t),this._model.addParameterValueById(this._idParamAngleX,30*this._dragX),this._model.addParameterValueById(this._idParamAngleY,30*this._dragY),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,10*this._dragX),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),null!=this._breath&&this._breath.updateParameters(this._model,t),null!=this._physics&&this._physics.evaluate(this._model,t),this._lipsync)for(var i=0;i<this._lipSyncIds.getSize();++i)this._model.addParameterValueById(this._lipSyncIds.at(i),0,.8);null!=this._pose&&this._pose.updateParameters(this._model,t),this._model.update()}},e.prototype.startMotion=function(t,e,i){var r=this;if(i==this._setting.Priority.Force)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&n.log("can't start motion."),Ri;var o=this._modelSetting.getMotionFileName(t,e),s=Ai.getFormatedString("{0}_{1}",t,e),a=this._motions.getValue(s),u=!1;if(null==a){var l=o;l=this._setting.baseUrl+l,fetch(l).then((function(t){return t.arrayBuffer()})).then((function(i){var n=i,o=n.byteLength;a=r.loadMotion(n,o,null);var s=r._modelSetting.getMotionFadeInTimeValue(t,e);s>=0&&a.setFadeInTime(s),(s=r._modelSetting.getMotionFadeOutTimeValue(t,e))>=0&&a.setFadeOutTime(s),a.setEffectIds(r._eyeBlinkIds,r._lipSyncIds),u=!0}))}return n.log("start motion: ["+t+"_"+e+"]",!0),this._motionManager.startMotionPriority(a,u,i)},e.prototype.startRandomMotion=function(t,e){if(0==this._modelSetting.getMotionCount(t))return Ri;var i=Math.floor(Math.random()*this._modelSetting.getMotionCount(t));return this.startMotion(t,i,e)},e.prototype.setExpression=function(t){var e=this._expressions.getValue(t);n.log("expression: ["+t+"]",!0),null!=e?this._expressionManager.startMotionPriority(e,!1,this._setting.Priority.Force):n.log("expression["+t+"] is null",!0)},e.prototype.setRandomExpression=function(){if(0!=this._expressions.getSize())for(var t=Math.floor(Math.random()*this._expressions.getSize()),e=0;e<this._expressions.getSize();e++)if(e==t){var i=this._expressions._keyValues[e].first;return void this.setExpression(i)}},e.prototype.motionEventFired=function(t){v("{0} is fired on LAppModel!!",t.s)},e.prototype.getHitList=function(t,e){for(var i=[],r=0,n=this.getDrawableIds();r<n.length;r++){var o=n[r],s=ji.getIdManager().getId(o),a=this.isHit(s,t,e);a.hit&&i.push({cubismIdHandle:s,area:a.area,id:o})}return i.sort((function(t,e){return t.area-e.area})),i},e.prototype.preLoadMotionGroup=function(t){for(var e=this,i=function(i){var o=Ai.getFormatedString("{0}_{1}",t,i),s=r._modelSetting.getMotionFileName(t,i);s=r._setting.baseUrl+s,n.log("load motion: "+s+" => ["+t+"_"+i+"]",!0),fetch(s).then((function(t){return t.arrayBuffer()})).then((function(r){var n=r,s=n.byteLength,a=e.loadMotion(n,s,o),u=e._modelSetting.getMotionFadeInTimeValue(t,i);u>=0&&a.setFadeInTime(u),(u=e._modelSetting.getMotionFadeOutTimeValue(t,i))>=0&&a.setFadeOutTime(u),a.setEffectIds(e._eyeBlinkIds,e._lipSyncIds),null!=e._motions.getValue(o)&&zi.delete(e._motions.getValue(o)),e._motions.setValue(o,a),e._motionCount++,e._motionCount>=e._allMotionCount&&(e._state=Ti.LoadTexture,e._motionManager.stopAllMotions(),e._updating=!1,e._initialized=!0,e.createRenderer(),e.setupTextures(),e.getRenderer().startUp(e._webgl.gl))}))},r=this,o=0;o<this._modelSetting.getMotionCount(t);o++)i(o)},e.prototype.releaseMotions=function(){this._motions.clear()},e.prototype.releaseExpressions=function(){this._expressions.clear()},e.prototype.doDraw=function(){if(null!=this._model){var t=[0,0,this._setting.canvas.width,this._setting.canvas.height];this.getRenderer().setRenderState(this._webgl.frameBuffer,t),this.getRenderer().drawModel()}},e.prototype.draw=function(t){null!=this._model&&this._state==Ti.CompleteSetup&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())},e.prototype.updateTime=function(){this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,this.s_lastFrame=this.s_currentFrame},e.prototype.onUpdate=function(){var t,e,i=new qi;t=this._setting.canvas.width,e=this._setting.canvas.height,i.scale(1,t/e),null!=this._viewMatrix&&i.multiplyByMatrix(this._viewMatrix),this.update(),this.draw(i)},e.prototype.getDrawableIds=function(){return this._model.getModel().drawables.ids},e}(Xi),Ji=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ki=E.CubismMatrix44;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._screenLeft=0,e._screenRight=0,e._screenTop=0,e._screenBottom=0,e._maxLeft=0,e._maxRight=0,e._maxTop=0,e._maxBottom=0,e._maxScale=0,e._minScale=0,e}return Ji(e,t),e.prototype.adjustTranslate=function(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);var i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);Ki.multiply(i,this._tr,this._tr)},e.prototype.adjustScale=function(t,e,i){var r=this.getMaxScale(),n=this.getMinScale(),o=i*this._tr[0];o<n?this._tr[0]>0&&(i=n/this._tr[0]):o>r&&this._tr[0]>0&&(i=r/this._tr[0]);var s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),a=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),u=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);Ki.multiply(u,this._tr,this._tr),Ki.multiply(a,this._tr,this._tr),Ki.multiply(s,this._tr,this._tr)},e.prototype.setScreenRect=function(t,e,i,r){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=r},e.prototype.setMaxScreenRect=function(t,e,i,r){this._maxLeft=t,this._maxRight=e,this._maxTop=r,this._maxBottom=i},e.prototype.setMaxScale=function(t){this._maxScale=t},e.prototype.setMinScale=function(t){this._minScale=t},e.prototype.getMaxScale=function(){return this._maxScale},e.prototype.getMinScale=function(){return this._minScale},e.prototype.isMaxScale=function(){return this.getScaleX()>=this._maxScale},e.prototype.isMinScale=function(){return this.getScaleX()<=this._minScale},e.prototype.getScreenLeft=function(){return this._screenLeft},e.prototype.getScreenRight=function(){return this._screenRight},e.prototype.getScreenBottom=function(){return this._screenBottom},e.prototype.getScreenTop=function(){return this._screenTop},e.prototype.getMaxLeft=function(){return this._maxLeft},e.prototype.getMaxRight=function(){return this._maxRight},e.prototype.getMaxBottom=function(){return this._maxBottom},e.prototype.getMaxTop=function(){return this._maxTop},e}(Ki);t.CubismViewMatrix=e}(Hi||(Hi={}));var Zi=Hi.CubismViewMatrix,Qi=E.CubismMatrix44,$i=function(){function t(t,e,i){var r,n;this._captured=!1,this._coordinateManager=new tr,this._deviceToScreen=new Qi,this._viewMatrix=new Zi,this._setting=t,this._view=e,this._model=i,r=t.canvas.width;var o=(n=t.canvas.height)/r,s=t.view.VIEW_LOGICAL_LEFT,a=t.view.VIEW_LOGICAL_RIGHT,u=-o,l=o;this._viewMatrix.setScreenRect(s,a,u,l);var h=Math.abs(s-a);this._deviceToScreen.scaleRelative(h/r,-h/r),this._deviceToScreen.translateRelative(.5*-r,.5*-n),this._viewMatrix.setMaxScale(t.view.VIEW_MAX_SCALE),this._viewMatrix.setMinScale(t.view.VIEW_MIN_SCALE),this._viewMatrix.setMaxScreenRect(t.view.VIEW_LOGICAL_MAX_LEFT,t.view.VIEW_LOGICAL_MAX_RIGHT,t.view.VIEW_LOGICAL_MAX_BOTTOM,t.view.VIEW_LOGICAL_MAX_TOP),this.bindEvent()}return t.prototype.bindEvent=function(){var t=this;"ontouchend"in this._setting.canvas?(this._setting.canvas.ontouchstart=function(e){t.onTouchBegan(e)},this._setting.canvas.ontouchmove=function(e){t.onTouchMoved(e)},this._setting.canvas.ontouchend=function(e){t.onTouchEnded(e)},this._setting.canvas.ontouchcancel=function(e){t.onTouchCancel(e)}):(this._setting.canvas.onmousedown=function(e){t.onClickBegan(e)},this._setting.canvas.onmousemove=function(e){t.onMouseMoved(e)},this._setting.canvas.onmouseup=function(e){t.onClickEnded(e)})},t.prototype.onClickBegan=function(t){this._captured=!0;var e=t.pageX,i=t.pageY;this.onTouchesBegan(e,i)},t.prototype.onMouseMoved=function(t){if(this._captured){var e=t.target.getBoundingClientRect(),i=t.clientX-e.left,r=t.clientY-e.top;this.onTouchesMoved(i,r)}},t.prototype.onClickEnded=function(t){this._captured=!1;var e=t.target.getBoundingClientRect(),i=t.clientX-e.left,r=t.clientY-e.top;this.onTouchesEnded(i,r)},t.prototype.onTouchBegan=function(t){this._captured=!0;var e=t.changedTouches[0].pageX,i=t.changedTouches[0].pageY;this.onTouchesBegan(e,i)},t.prototype.onTouchMoved=function(t){if(this._captured){var e=t.target.getBoundingClientRect(),i=t.changedTouches[0].clientX-e.left,r=t.changedTouches[0].clientY-e.top;this.onTouchesMoved(i,r)}},t.prototype.onTouchEnded=function(t){this._captured=!1;var e=t.target.getBoundingClientRect(),i=t.changedTouches[0].clientX-e.left,r=t.changedTouches[0].clientY-e.top;this.onTouchesEnded(i,r)},t.prototype.onTouchCancel=function(t){this._captured=!1;var e=t.target.getBoundingClientRect(),i=t.changedTouches[0].clientX-e.left,r=t.changedTouches[0].clientY-e.top;this.onTouchesEnded(i,r)},t.prototype.onTouchesBegan=function(t,e){this._coordinateManager.touchesBegan(t,e)},t.prototype.onTouchesMoved=function(t,e){var i=this.transformViewX(this._coordinateManager.getX()),r=this.transformViewY(this._coordinateManager.getY());this._coordinateManager.touchesMoved(t,e),this._model.setDragging(i,r)},t.prototype.onTouchesEnded=function(t,e){this._model.setDragging(0,0);var i=this._deviceToScreen.transformX(this._coordinateManager.getX()),r=this._deviceToScreen.transformY(this._coordinateManager.getY());this.onTap(i,r)},t.prototype.transformViewX=function(t){var e=this._deviceToScreen.transformX(t);return this._viewMatrix.invertTransformX(e)},t.prototype.transformViewY=function(t){var e=this._deviceToScreen.transformY(t);return this._viewMatrix.invertTransformY(e)},t.prototype.transformScreenX=function(t){return this._deviceToScreen.transformX(t)},t.prototype.transformScreenY=function(t){return this._deviceToScreen.transformY(t)},t.prototype.onTap=function(t,e){n.log("onTap x: "+t+" y: "+e,!0);for(var i=0,r=this._model.getHitList(t,e);i<r.length;i++){var o=r[i];if(this._setting.debug&&n.log("Hit drawId : "+o.id,!0),this._setting.binding[o.id])return void this._model.startRandomMotion(a.getRandomItem(this._setting.binding[o.id].motion),2);this._setting.debug&&n.log("Hit drawId "+o.id+" not found binding",!0)}},t}(),tr=function(){function t(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}return t.prototype.getCenterX=function(){return this._lastX},t.prototype.getCenterY=function(){return this._lastY},t.prototype.getDeltaX=function(){return this._deltaX},t.prototype.getDeltaY=function(){return this._deltaY},t.prototype.getStartX=function(){return this._startX},t.prototype.getStartY=function(){return this._startY},t.prototype.getScale=function(){return this._scale},t.prototype.getX=function(){return this._lastX},t.prototype.getY=function(){return this._lastY},t.prototype.getX1=function(){return this._lastX1},t.prototype.getY1=function(){return this._lastY1},t.prototype.getX2=function(){return this._lastX2},t.prototype.getY2=function(){return this._lastY2},t.prototype.isSingleTouch=function(){return this._touchSingle},t.prototype.isFlickAvailable=function(){return this._flipAvailable},t.prototype.disableFlick=function(){this._flipAvailable=!1},t.prototype.touchesBegan=function(t,e){this._lastX=t,this._lastY=e,this._startX=t,this._startY=e,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0},t.prototype.touchesMoved=function(t,e){this._lastX=t,this._lastY=e,this._lastTouchDistance=-1,this._touchSingle=!0},t.prototype.getFlickDistance=function(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)},t.prototype.calculateDistance=function(t,e,i,r){return Math.sqrt((t-i)*(t-i)+(e-r)*(e-r))},t.prototype.calculateMovingAmount=function(t,e){if(t>0!=e>0)return 0;var i=t>0?1:-1,r=Math.abs(t),n=Math.abs(e);return i*(r<n?r:n)},t}(),er=E.CubismMatrix44,ir=k.CubismFramework,rr=function(){function t(t){this._cubismOption=new j,this._webgl=new J(t.canvas),this._view=new K(this._webgl),this._textureManager=new H(this._webgl),this._cubismOption.logFunction=n.log,this._cubismOption.loggingLevel=0,ir.startUp(this._cubismOption),ir.initialize();new er;this._model=new Wi(t,this._textureManager,this._webgl),this._touchManage=new $i(t,this._view,this._model),this.loop()}return t.prototype.loop=function(){var t=this;this._model.updateTime(),this._webgl.gl.clearColor(0,0,0,0),this._webgl.gl.enable(this._webgl.gl.DEPTH_TEST),this._webgl.gl.depthFunc(this._webgl.gl.LEQUAL),this._webgl.gl.clear(this._webgl.gl.COLOR_BUFFER_BIT|this._webgl.gl.DEPTH_BUFFER_BIT),this._webgl.gl.clearDepth(1),this._webgl.gl.enable(this._webgl.gl.BLEND),this._webgl.gl.blendFunc(this._webgl.gl.SRC_ALPHA,this._webgl.gl.ONE_MINUS_SRC_ALPHA),this._view.render(),this._model.onUpdate(),requestAnimationFrame((function(){t.loop()}))},t}(),nr=function(){function t(t,e){this._setting=t,this._cubismSDK=e}return Object.defineProperty(t.prototype,"HitAreasList",{get:function(){return this._cubismSDK._model.getDrawableIds()},enumerable:!0,configurable:!0}),t}(),or=function(){function t(t,e){var i=this;this.setting=new h,this.setting.init(t,e).then((function(){i.load()})),this.setting.canvas._Live2dHelper=this}return t.prototype.load=function(){this.cubismSDK=new rr(this.setting),this.modelInfo=new nr(this.setting,this.cubismSDK)},t}();e.default=or}]).default}));